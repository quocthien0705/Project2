{"version":3,"file":"TableSelector.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/TableResize/editors/TableSelector.ts"],"names":[],"mappings":"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","sourcesContent":["import DragAndDropHelper from '../../../pluginUtils/DragAndDropHelper';\nimport type DragAndDropHandler from '../../../pluginUtils/DragAndDropHandler';\nimport type TableEditorFeature from './TableEditorFeature';\nimport type { CreateElementData, IEditor, Rect } from 'roosterjs-editor-types';\nimport {\n    createElement,\n    normalizeRect,\n    safeInstanceOf,\n    getComputedStyle,\n} from 'roosterjs-editor-dom';\n\nconst TABLE_SELECTOR_LENGTH = 12;\nconst TABLE_SELECTOR_ID = '_Table_Selector';\n\n/**\n * @internal\n */\nexport default function createTableSelector(\n    table: HTMLTableElement,\n    editor: IEditor,\n    onFinishDragging: (table: HTMLTableElement) => void,\n    getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n    onShowHelperElement?: (\n        elementData: CreateElementData,\n        helperType: 'CellResizer' | 'TableInserter' | 'TableResizer' | 'TableSelector',\n        table: HTMLTableElement\n    ) => void,\n    contentDiv?: EventTarget | null,\n    anchorContainer?: HTMLElement\n): TableEditorFeature | null {\n    const rect = normalizeRect(table.getBoundingClientRect());\n\n    if (!isTableTopVisible(editor, rect, contentDiv)) {\n        return null;\n    }\n\n    const zoomScale = editor.getZoomScale();\n    const document = table.ownerDocument;\n    const createElementData = {\n        tag: 'div',\n        style: 'position: fixed; cursor: all-scroll; user-select: none; border: 1px solid #808080',\n    };\n\n    onShowHelperElement?.(createElementData, 'TableSelector', table);\n\n    const div = createElement(createElementData, document) as HTMLDivElement;\n\n    div.id = TABLE_SELECTOR_ID;\n    div.style.width = `${TABLE_SELECTOR_LENGTH}px`;\n    div.style.height = `${TABLE_SELECTOR_LENGTH}px`;\n\n    (anchorContainer || document.body).appendChild(div);\n\n    const context: TableSelectorContext = {\n        table,\n        zoomScale,\n        rect,\n        isRTL: getComputedStyle(table, 'direction') == 'rtl',\n    };\n\n    setDivPosition(context, div);\n\n    const onDragEnd = (context: TableSelectorContext, event: MouseEvent): false => {\n        if (event.target == div) {\n            onFinishDragging(context.table);\n        }\n        return false;\n    };\n\n    const featureHandler = new TableSelectorFeature(\n        div,\n        context,\n        setDivPosition,\n        {\n            onDragEnd,\n        },\n        context.zoomScale,\n        getOnMouseOut\n    );\n\n    return { div, featureHandler, node: table };\n}\n\ninterface TableSelectorContext {\n    table: HTMLTableElement;\n    zoomScale: number;\n    rect: Rect | null;\n    isRTL: boolean;\n}\n\ninterface TableSelectorInitValue {\n    event: MouseEvent;\n}\n\nclass TableSelectorFeature extends DragAndDropHelper<TableSelectorContext, TableSelectorInitValue> {\n    private onMouseOut: ((ev: MouseEvent) => void) | null;\n\n    constructor(\n        private div: HTMLElement,\n        context: TableSelectorContext,\n        onSubmit: (\n            context: TableSelectorContext,\n            trigger: HTMLElement,\n            container?: HTMLElement\n        ) => void,\n        handler: DragAndDropHandler<TableSelectorContext, TableSelectorInitValue>,\n        zoomScale: number,\n        getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n        forceMobile?: boolean | undefined,\n        container?: HTMLElement\n    ) {\n        super(div, context, onSubmit, handler, zoomScale, forceMobile);\n        this.onMouseOut = getOnMouseOut(div);\n        div.addEventListener('mouseout', this.onMouseOut);\n    }\n\n    dispose(): void {\n        super.dispose();\n        if (this.onMouseOut) {\n            this.div.removeEventListener('mouseout', this.onMouseOut);\n        }\n        this.onMouseOut = null;\n    }\n}\n\nfunction setDivPosition(context: TableSelectorContext, trigger: HTMLElement) {\n    const { rect } = context;\n    if (rect) {\n        trigger.style.top = `${rect.top - TABLE_SELECTOR_LENGTH}px`;\n        trigger.style.left = `${rect.left - TABLE_SELECTOR_LENGTH - 2}px`;\n    }\n}\n\nfunction isTableTopVisible(\n    editor: IEditor,\n    rect: Rect | null,\n    contentDiv?: EventTarget | null\n): boolean {\n    const visibleViewport = editor.getVisibleViewport();\n    if (contentDiv && safeInstanceOf(contentDiv, 'HTMLElement') && visibleViewport && rect) {\n        const containerRect = normalizeRect(contentDiv.getBoundingClientRect());\n\n        return !!containerRect && containerRect.top <= rect.top && visibleViewport.top <= rect.top;\n    }\n\n    return true;\n}\n"]}