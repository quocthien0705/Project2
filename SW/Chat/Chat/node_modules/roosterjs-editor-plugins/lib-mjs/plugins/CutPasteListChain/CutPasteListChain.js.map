{"version":3,"file":"CutPasteListChain.js","sourceRoot":"","sources":["../../../../../packages/roosterjs-editor-plugins/lib/plugins/CutPasteListChain/CutPasteListChain.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,gBAAgB,EAAE,MAAM,sBAAsB,CAAC;AACxD,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAC;AAIlD;;GAEG;AACH;IAAA;QAAA,iBAyEC;QAxEW,WAAM,GAAwB,IAAI,CAAC;QACnC,yBAAoB,GAAiD,IAAI,CAAC;QAC1E,WAAM,GAAmB,IAAI,CAAC;QAC9B,aAAQ,GAAwB,IAAI,CAAC;QA0DrC,WAAM,GAAG;YACb,KAAI,CAAC,eAAe,mBAAmB,CAAC;QAC5C,CAAC,CAAC;IASN,CAAC;IAnEG;;OAEG;IACH,mCAAO,GAAP;QACI,OAAO,mBAAmB,CAAC;IAC/B,CAAC;IAED;;;OAGG;IACH,sCAAU,GAAV,UAAW,MAAe;QACtB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;IACxE,CAAC;IAED;;OAEG;IACH,mCAAO,GAAP;;QACI,MAAA,IAAI,CAAC,QAAQ,+CAAb,IAAI,CAAa,CAAC;QAClB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,CAAC;IAED;;;OAGG;IACH,yCAAa,GAAb,UAAc,KAAkB;QAC5B,QAAQ,KAAK,CAAC,SAAS,EAAE;YACrB;gBACI,IAAI,KAAK,CAAC,KAAK,EAAE;oBACb,IAAI,CAAC,eAAe,iBAAkB,CAAC;iBAC1C;gBACD,MAAM;YAEV;gBACI,IAAI,CAAC,eAAe,qBAAoB,CAAC;gBACzC,MAAM;YAEV;gBACI,IACI,IAAI,CAAC,MAAM;oBACX,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC;oBACtB,IAAI,CAAC,oBAAoB,IAAI,KAAK,CAAC,MAAM;oBACzC,IAAI,CAAC,MAAM,EACb;oBACE,gBAAgB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;oBAC3C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;oBACnB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;iBACpC;gBACD,MAAM;SACb;IACL,CAAC;IAMO,2CAAe,GAAvB,UAAwB,MAAoB;;QACxC,IAAM,eAAe,GAAG,MAAA,IAAI,CAAC,MAAM,0CAAE,kBAAkB,EAAE,CAAC;QAC1D,IAAI,eAAe,EAAE;YACjB,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;YAC3D,IAAI,CAAC,oBAAoB,GAAG,MAAM,CAAC;SACtC;IACL,CAAC;IACL,wBAAC;AAAD,CAAC,AAzED,IAyEC","sourcesContent":["import { ChangeSource, PluginEventType } from 'roosterjs-editor-types';\nimport { commitListChains } from 'roosterjs-editor-api';\nimport { VListChain } from 'roosterjs-editor-dom';\nimport type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-editor-types';\nimport type { CompatibleChangeSource } from 'roosterjs-editor-types/lib/compatibleTypes';\n\n/**\n * Maintain list numbers of list chain when content is modified by cut/paste/drag&drop\n */\nexport default class CutPasteListChain implements EditorPlugin {\n    private chains: VListChain[] | null = null;\n    private expectedChangeSource: ChangeSource | CompatibleChangeSource | null = null;\n    private editor: IEditor | null = null;\n    private disposer: (() => void) | null = null;\n\n    /**\n     * Get a friendly name of this plugin\n     */\n    getName() {\n        return 'CutPasteListChain';\n    }\n\n    /**\n     * Initialize this plugin\n     * @param editor The editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        this.disposer = this.editor.addDomEventHandler('drop', this.onDrop);\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.disposer?.();\n        this.disposer = null;\n        this.editor = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        switch (event.eventType) {\n            case PluginEventType.BeforeCutCopy:\n                if (event.isCut) {\n                    this.cacheListChains(ChangeSource.Cut);\n                }\n                break;\n\n            case PluginEventType.BeforePaste:\n                this.cacheListChains(ChangeSource.Paste);\n                break;\n\n            case PluginEventType.ContentChanged:\n                if (\n                    this.chains &&\n                    this.chains.length > 0 &&\n                    this.expectedChangeSource == event.source &&\n                    this.editor\n                ) {\n                    commitListChains(this.editor, this.chains);\n                    this.chains = null;\n                    this.expectedChangeSource = null;\n                }\n                break;\n        }\n    }\n\n    private onDrop = () => {\n        this.cacheListChains(ChangeSource.Drop);\n    };\n\n    private cacheListChains(source: ChangeSource) {\n        const selectedRegions = this.editor?.getSelectedRegions();\n        if (selectedRegions) {\n            this.chains = VListChain.createListChains(selectedRegions);\n            this.expectedChangeSource = source;\n        }\n    }\n}\n"]}