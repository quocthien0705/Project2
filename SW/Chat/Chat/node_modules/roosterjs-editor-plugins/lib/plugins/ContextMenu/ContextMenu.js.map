{"version":3,"file":"ContextMenu.js","sourceRoot":"","sources":["../../../../../packages/roosterjs-editor-plugins/lib/plugins/ContextMenu/ContextMenu.ts"],"names":[],"mappings":";;AAAA,6DAAqD;AA8BrD;;GAEG;AACH;IAKI;;;OAGG;IACH,qBAAoB,OAA8B;QAAlD,iBAAsD;QAAlC,YAAO,GAAP,OAAO,CAAuB;QAR1C,cAAS,GAAuB,IAAI,CAAC;QACrC,WAAM,GAAmB,IAAI,CAAC;QAC9B,kBAAa,GAAY,KAAK,CAAC;QAsE/B,cAAS,GAAG;;YAChB,IAAI,KAAI,CAAC,SAAS,IAAI,KAAI,CAAC,aAAa,EAAE;gBACtC,MAAA,MAAA,KAAI,CAAC,OAAO,EAAC,OAAO,mDAAG,KAAI,CAAC,SAAS,CAAC,CAAC;gBACvC,KAAI,CAAC,aAAa,GAAG,KAAK,CAAC;aAC9B;QACL,CAAC,CAAC;IArEmD,CAAC;IAEtD;;OAEG;IACH,6BAAO,GAAP;QACI,OAAO,aAAa,CAAC;IACzB,CAAC;IAED;;;OAGG;IACH,gCAAU,GAAV,UAAW,MAAe;QACtB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACzB,CAAC;IAED;;OAEG;IACH,6BAAO,GAAP;;QACI,IAAI,CAAC,SAAS,EAAE,CAAC;QAEjB,IAAI,MAAA,IAAI,CAAC,SAAS,0CAAE,UAAU,EAAE;YAC5B,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACtD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;SACzB;QACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,CAAC;IAED;;;OAGG;IACH,mCAAa,GAAb,UAAc,KAAkB;QAC5B,IAAI,KAAK,CAAC,SAAS,wBAA+B,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;YAClE,IAAA,QAAQ,GAAY,KAAK,SAAjB,EAAE,KAAK,GAAK,KAAK,MAAV,CAAW;YAElC,IAAI,CAAC,SAAS,EAAE,CAAC;YAEjB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;gBAChC,QAAQ,CAAC,cAAc,EAAE,CAAC;aAC7B;YAED,IAAI,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,KAAK,CAAC,EAAE;gBACpD,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,SAAU,EAAE,KAAY,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;gBACnE,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;aAC7B;SACJ;IACL,CAAC;IAEO,mCAAa,GAArB,UAAsB,CAAS,EAAE,CAAS;;QACtC,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,EAAE;YAChC,IAAI,CAAC,SAAS,GAAG,IAAA,oCAAa,8BAE1B,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CACb,CAAC;YACjB,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC9D;QACD,MAAA,IAAI,CAAC,SAAS,0CAAE,KAAK,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;QACpD,MAAA,IAAI,CAAC,SAAS,0CAAE,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;QACnD,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;IAC5B,CAAC;IAQL,kBAAC;AAAD,CAAC,AA/ED,IA+EC","sourcesContent":["import { createElement } from 'roosterjs-editor-dom';\nimport { KnownCreateElementDataIndex, PluginEventType } from 'roosterjs-editor-types';\nimport type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-editor-types';\n\n/**\n * Context Menu options for ContextMenu plugin\n */\nexport interface ContextMenuOptions<T> {\n    /**\n     * Render function for the context menu\n     * @param container The container HTML element, it will be located at the mouse click position,\n     * so the callback just need to render menu content into this container\n     * @param onDismiss The onDismiss callback, some menu render need to know this callback so that\n     * it can handle the dismiss event\n     */\n    render: (container: HTMLElement, items: (T | null)[], onDismiss: () => void) => void;\n\n    /**\n     * Dismiss function for the context menu, it will be called when user wants to dismiss this context menu\n     * e.g. user click away so the menu should be dismissed\n     * @param container The container HTML element\n     */\n    dismiss?: (container: HTMLElement) => void;\n\n    /**\n     * Whether the default context menu is allowed. @default false\n     */\n    allowDefaultMenu?: boolean;\n}\n\n/**\n * An editor plugin that support showing a context menu using render() function from options parameter\n */\nexport default class ContextMenu<T> implements EditorPlugin {\n    private container: HTMLElement | null = null;\n    private editor: IEditor | null = null;\n    private isMenuShowing: boolean = false;\n\n    /**\n     * Create a new instance of ContextMenu class\n     * @param options An options object to determine how to show/hide the context menu\n     */\n    constructor(private options: ContextMenuOptions<T>) {}\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'ContextMenu';\n    }\n\n    /**\n     * Initialize this plugin\n     * @param editor The editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.onDismiss();\n\n        if (this.container?.parentNode) {\n            this.container.parentNode.removeChild(this.container);\n            this.container = null;\n        }\n        this.editor = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (event.eventType == PluginEventType.ContextMenu && event.items.length > 0) {\n            const { rawEvent, items } = event;\n\n            this.onDismiss();\n\n            if (!this.options.allowDefaultMenu) {\n                rawEvent.preventDefault();\n            }\n\n            if (this.initContainer(rawEvent.pageX, rawEvent.pageY)) {\n                this.options.render(this.container!, items as T[], this.onDismiss);\n                this.isMenuShowing = true;\n            }\n        }\n    }\n\n    private initContainer(x: number, y: number) {\n        if (!this.container && this.editor) {\n            this.container = createElement(\n                KnownCreateElementDataIndex.ContextMenuWrapper,\n                this.editor.getDocument()\n            ) as HTMLElement;\n            this.editor.getDocument().body.appendChild(this.container);\n        }\n        this.container?.style.setProperty('left', x + 'px');\n        this.container?.style.setProperty('top', y + 'px');\n        return !!this.container;\n    }\n\n    private onDismiss = () => {\n        if (this.container && this.isMenuShowing) {\n            this.options.dismiss?.(this.container);\n            this.isMenuShowing = false;\n        }\n    };\n}\n"]}