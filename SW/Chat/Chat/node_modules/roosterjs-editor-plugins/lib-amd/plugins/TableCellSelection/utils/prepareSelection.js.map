{"version":3,"file":"prepareSelection.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/TableCellSelection/utils/prepareSelection.ts"],"names":[],"mappings":";;;;IAMA;;;OAGG;IACH,SAAgB,gBAAgB,CAAC,KAA8B,EAAE,MAAe;;QAC5E,IAAI,CAAC,KAAK,CAAC,UAAU,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE;YACzC,OAAO;SACV;QACD,IAAI,yBAAyB,GACzB,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,WAAW;aACrC,MAAA,KAAK,CAAC,UAAU,0CAAE,QAAQ,CACtB,IAAA,iDAA0B,EAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,UAAU,EAAE,+BAAmB,CAAC,CACvF,CAAA,CAAC;QAEN,IAAI,yBAAyB,IAAI,KAAK,CAAC,cAAc,EAAE;YACnD,OAAO,yBAAyB,EAAE;gBAC9B,KAAK,CAAC,UAAU,GAAG,IAAA,iDAA0B,EACzC,KAAK,CAAC,WAAW,EACjB,KAAK,CAAC,UAAU,EAChB,+BAAmB,CACtB,CAAC;gBACF,KAAK,CAAC,WAAW,GAAG,IAAA,mCAAgB,EAAC,MAAM,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;gBAC/D,yBAAyB;oBACrB,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,WAAW;yBACrC,MAAA,KAAK,CAAC,UAAU,0CAAE,QAAQ,CACtB,IAAA,iDAA0B,EACtB,KAAK,CAAC,WAAW,EACjB,KAAK,CAAC,UAAU,EAChB,+BAAmB,CACtB,CACJ,CAAA,CAAC;aACT;SACJ;QAED,IAAI,2BAA2B,GAC3B,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,WAAW;aACrC,MAAA,KAAK,CAAC,WAAW,0CAAE,QAAQ,CACvB,IAAA,iDAA0B,EAAC,KAAK,CAAC,UAAU,EAAE,KAAK,CAAC,WAAW,EAAE,+BAAmB,CAAC,CACvF,CAAA,CAAC;QAEN,IAAI,2BAA2B,IAAI,KAAK,CAAC,cAAc,IAAI,KAAK,CAAC,WAAW,EAAE;YAC1E,OAAO,2BAA2B,EAAE;gBAChC,KAAK,CAAC,WAAW,GAAG,IAAA,iDAA0B,EAC1C,KAAK,CAAC,UAAU,EAChB,KAAK,CAAC,WAAW,EACjB,+BAAmB,CACtB,CAAC;gBACF,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE;oBACpB,OAAO;iBACV;gBACD,KAAK,CAAC,UAAU,GAAG,IAAA,mCAAgB,EAAC,MAAM,EAAE,KAAK,CAAC,WAAW,CAAC,CAAC;gBAC/D,2BAA2B;oBACvB,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,WAAW;yBACrC,MAAA,KAAK,CAAC,WAAW,0CAAE,QAAQ,CACvB,IAAA,iDAA0B,EACtB,KAAK,CAAC,UAAU,EAChB,KAAK,CAAC,WAAW,EACjB,+BAAmB,CACtB,CACJ,CAAA,CAAC;aACT;SACJ;IACL,CAAC;IA1DD,4CA0DC","sourcesContent":["import { findClosestElementAncestor } from 'roosterjs-editor-dom';\nimport { getTableAtCursor } from './getTableAtCursor';\nimport { TABLE_CELL_SELECTOR } from '../constants';\nimport type { IEditor } from 'roosterjs-editor-types';\nimport type { TableCellSelectionState } from '../TableCellSelectionState';\n\n/**\n * @internal\n *  Check if the selection started in a inner table.\n */\nexport function prepareSelection(state: TableCellSelectionState, editor: IEditor) {\n    if (!state.firstTable || !state.targetTable) {\n        return;\n    }\n    let isNewTargetTableContained =\n        state.lastTarget != state.firstTarget &&\n        state.firstTable?.contains(\n            findClosestElementAncestor(state.targetTable, state.firstTable, TABLE_CELL_SELECTOR)\n        );\n\n    if (isNewTargetTableContained && state.tableSelection) {\n        while (isNewTargetTableContained) {\n            state.lastTarget = findClosestElementAncestor(\n                state.targetTable,\n                state.firstTable,\n                TABLE_CELL_SELECTOR\n            );\n            state.targetTable = getTableAtCursor(editor, state.lastTarget);\n            isNewTargetTableContained =\n                state.lastTarget != state.firstTarget &&\n                state.firstTable?.contains(\n                    findClosestElementAncestor(\n                        state.targetTable,\n                        state.firstTable,\n                        TABLE_CELL_SELECTOR\n                    )\n                );\n        }\n    }\n\n    let isFirstTargetTableContained =\n        state.lastTarget != state.firstTarget &&\n        state.targetTable?.contains(\n            findClosestElementAncestor(state.firstTable, state.targetTable, TABLE_CELL_SELECTOR)\n        );\n\n    if (isFirstTargetTableContained && state.tableSelection && state.targetTable) {\n        while (isFirstTargetTableContained) {\n            state.firstTarget = findClosestElementAncestor(\n                state.firstTable,\n                state.targetTable,\n                TABLE_CELL_SELECTOR\n            );\n            if (!state.firstTarget) {\n                return;\n            }\n            state.firstTable = getTableAtCursor(editor, state.firstTarget);\n            isFirstTargetTableContained =\n                state.lastTarget != state.firstTarget &&\n                state.targetTable?.contains(\n                    findClosestElementAncestor(\n                        state.firstTable,\n                        state.targetTable,\n                        TABLE_CELL_SELECTOR\n                    )\n                );\n        }\n    }\n}\n"]}