{"version":3,"file":"structuredNodeFeatures.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/ContentEdit/features/structuredNodeFeatures.ts"],"names":[],"mappings":";;;;IAgBA,IAAM,oBAAoB,GAAmC;QACzD,EAAE,EAAE,OAAO;QACX,EAAE,EAAE,OAAO;QACX,EAAE,EAAE,OAAO;KACd,CAAC;IACF,IAAM,cAAc,GAAG,IAAA,oCAAa,EAAC,oBAAoB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAErE;;;;OAIG;IACH,IAAM,qCAAqC,GAA4C;QACnF,IAAI,EAAE,gBAAY;QAClB,iBAAiB,EAAE,yBAAyB;QAC5C,WAAW,EAAE,UAAC,KAAK,EAAE,MAAM;YACvB,IAAM,OAAO,GAAG,yBAAyB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YACzD,IAAM,GAAG,GAAG,IAAA,oCAAa,qBAErB,MAAM,CAAC,WAAW,EAAE,CACR,CAAC;YACjB,MAAM,CAAC,eAAe,CAAC;;gBACnB,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,UAAU,0CAAE,YAAY,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;gBAChD,gFAAgF;gBAChF,IAAI,IAAA,mCAAY,EAAC,OAAO,CAAC,IAAI,OAAO,EAAE;oBAClC,MAAM,CAAC,MAAM,CAAC,IAAI,+BAAQ,CAAC,GAAG,gBAAqB,CAAC,SAAS,EAAE,CAAC,CAAC;iBACpE;YACL,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;QACpC,CAAC;QACD,eAAe,EAAE,IAAI;KACxB,CAAC;IAEF,SAAS,yBAAyB,CAAC,KAA0B,EAAE,MAAe;QAC1E,OAAO,IAAA,wCAAiB,EAAC,KAAK,EAAE,iBAAiB,EAAE;YAC/C,sEAAsE;YACtE,IAAM,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC;YAE3F,IAAI,OAAO,EAAE;gBACT,IAAM,KAAK,GAAG,MAAM,CAAC,iBAAiB,EAAE,CAAC;gBACzC,IACI,KAAK;oBACL,KAAK,CAAC,SAAS;oBACf,IAAA,8CAAuB,EAAC,+BAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,OAAO,CAAC;oBAC1D,CAAC,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,uBAAuB,EAAE,EAC7D;oBACE,OAAO,MAAM,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,IAAA,mCAAY,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC;iBACjF;aACJ;YAED,OAAO,IAAI,CAAC;QAChB,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;OAEG;IACU,QAAA,sBAAsB,GAG/B;QACA,qCAAqC,EAAE,qCAAqC;KAC/E,CAAC","sourcesContent":["import { Keys, KnownCreateElementDataIndex, PositionType } from 'roosterjs-editor-types';\nimport type {\n    BuildInEditFeature,\n    IEditor,\n    PluginKeyboardEvent,\n    StructuredNodeFeatureSettings,\n} from 'roosterjs-editor-types';\nimport {\n    cacheGetEventData,\n    isPositionAtBeginningOf,\n    Position,\n    getTagOfNode,\n    createElement,\n    getObjectKeys,\n} from 'roosterjs-editor-dom';\n\nconst CHILD_PARENT_TAG_MAP: { [childTag: string]: string } = {\n    TD: 'TABLE',\n    TH: 'TABLE',\n    LI: 'OL,UL',\n};\nconst CHILD_SELECTOR = getObjectKeys(CHILD_PARENT_TAG_MAP).join(',');\n\n/**\n * InsertLineBeforeStructuredNode edit feature, provides the ability to insert an empty line before\n * a structured element (bullet/numbering list, blockquote, table) if the element is at beginning of\n * document\n */\nconst InsertLineBeforeStructuredNodeFeature: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.ENTER],\n    shouldHandleEvent: cacheGetStructuredElement,\n    handleEvent: (event, editor) => {\n        const element = cacheGetStructuredElement(event, editor);\n        const div = createElement(\n            KnownCreateElementDataIndex.EmptyLine,\n            editor.getDocument()\n        ) as HTMLElement;\n        editor.addUndoSnapshot(() => {\n            element?.parentNode?.insertBefore(div, element);\n            // Select the new line when we are in table. This is the same behavior with Word\n            if (getTagOfNode(element) == 'TABLE') {\n                editor.select(new Position(div, PositionType.Begin).normalize());\n            }\n        });\n        event.rawEvent.preventDefault();\n    },\n    defaultDisabled: true,\n};\n\nfunction cacheGetStructuredElement(event: PluginKeyboardEvent, editor: IEditor) {\n    return cacheGetEventData(event, 'FIRST_STRUCTURE', () => {\n        // Provide a chance to keep browser default behavior by pressing SHIFT\n        const element = event.rawEvent.shiftKey ? null : editor.getElementAtCursor(CHILD_SELECTOR);\n\n        if (element) {\n            const range = editor.getSelectionRange();\n            if (\n                range &&\n                range.collapsed &&\n                isPositionAtBeginningOf(Position.getStart(range), element) &&\n                !editor.getBodyTraverser(element).getPreviousBlockElement()\n            ) {\n                return editor.getElementAtCursor(CHILD_PARENT_TAG_MAP[getTagOfNode(element)]);\n            }\n        }\n\n        return null;\n    });\n}\n\n/**\n * @internal\n */\nexport const StructuredNodeFeatures: Record<\n    keyof StructuredNodeFeatureSettings,\n    BuildInEditFeature<PluginKeyboardEvent>\n> = {\n    insertLineBeforeStructuredNodeFeature: InsertLineBeforeStructuredNodeFeature,\n};\n"]}