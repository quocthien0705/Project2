{"version":3,"file":"listFeatures.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/ContentEdit/features/listFeatures.ts"],"names":[],"mappings":"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","sourcesContent":["import getAnnounceDataForList from '../../../pluginUtils/announceData/getAnnounceDataForList';\nimport getAutoBulletListStyle from '../utils/getAutoBulletListStyle';\nimport getAutoNumberingListStyle from '../utils/getAutoNumberingListStyle';\nimport {\n    Browser,\n    cacheGetEventData,\n    createNumberDefinition,\n    createObjectDefinition,\n    createVListFromRegion,\n    findClosestElementAncestor,\n    getComputedStyle,\n    getMetadata,\n    getTagOfNode,\n    isBlockElement,\n    isNodeEmpty,\n    isPositionAtBeginningOf,\n    Position,\n    safeInstanceOf,\n    VList,\n    VListChain,\n} from 'roosterjs-editor-dom';\nimport {\n    blockFormat,\n    commitListChains,\n    setIndentation,\n    toggleBullet,\n    toggleNumbering,\n    toggleListType,\n} from 'roosterjs-editor-api';\nimport type {\n    BuildInEditFeature,\n    IEditor,\n    ListFeatureSettings,\n    PluginKeyboardEvent,\n} from 'roosterjs-editor-types';\nimport {\n    Indentation,\n    Keys,\n    QueryScope,\n    ListType,\n    ExperimentalFeatures,\n    PositionType,\n    NumberingListType,\n    BulletListType,\n    ChangeSource,\n} from 'roosterjs-editor-types';\n\nconst PREVIOUS_BLOCK_CACHE_KEY = 'previousBlock';\nconst NEXT_BLOCK_CACHE_KEY = 'nextBlock';\n\ninterface ListStyleMetadata {\n    orderedStyleType?: NumberingListType;\n    unorderedStyleType?: BulletListType;\n}\n\nconst ListStyleDefinitionMetadata = createObjectDefinition<ListStyleMetadata>(\n    {\n        orderedStyleType: createNumberDefinition(\n            true /** isOptional */,\n            undefined /** value **/,\n            NumberingListType.Min,\n            NumberingListType.Max\n        ),\n        unorderedStyleType: createNumberDefinition(\n            true /** isOptional */,\n            undefined /** value **/,\n            BulletListType.Min,\n            BulletListType.Max\n        ),\n    },\n    true /** isOptional */,\n    true /** allowNull */\n);\n\nconst shouldHandleIndentationEvent = (indenting: boolean) => (\n    event: PluginKeyboardEvent,\n    editor: IEditor\n) => {\n    const { keyCode, altKey, shiftKey, ctrlKey, metaKey } = event.rawEvent;\n    return (\n        !ctrlKey &&\n        !metaKey &&\n        (keyCode === Keys.TAB\n            ? !altKey && shiftKey === !indenting\n            : shiftKey && altKey && keyCode === (indenting ? Keys.RIGHT : Keys.LEFT)) &&\n        cacheGetListElement(event, editor)\n    );\n};\n\nconst handleIndentationEvent = (indenting: boolean) => (\n    event: PluginKeyboardEvent,\n    editor: IEditor\n) => {\n    let currentElement: Node | null = null;\n    const isRTL =\n        event.rawEvent.keyCode !== Keys.TAB &&\n        (currentElement = editor.getElementAtCursor()) &&\n        getComputedStyle(currentElement, 'direction') == 'rtl';\n\n    editor.addUndoSnapshot(\n        () => {\n            setIndentation(\n                editor,\n                isRTL == indenting ? Indentation.Decrease : Indentation.Increase\n            );\n        },\n        ChangeSource.Format,\n        false /* canUndoByBackspace */,\n        {\n            getAnnounceData: () =>\n                getAnnounceDataForList(\n                    editor.getElementAtCursor('OL,UL'),\n                    editor.getElementAtCursor('LI')\n                ),\n        }\n    );\n\n    event.rawEvent.preventDefault();\n};\n\n/**\n * IndentWhenTab edit feature, provides the ability to indent current list when user press TAB\n */\nconst IndentWhenTab: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.TAB],\n    shouldHandleEvent: shouldHandleIndentationEvent(true),\n    handleEvent: handleIndentationEvent(true),\n};\n\n/**\n * OutdentWhenShiftTab edit feature, provides the ability to outdent current list when user press Shift+TAB\n */\nconst OutdentWhenShiftTab: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.TAB],\n    shouldHandleEvent: shouldHandleIndentationEvent(false),\n    handleEvent: handleIndentationEvent(false),\n    allowFunctionKeys: true,\n};\n\n/**\n * indentWhenAltShiftRight edit feature, provides the ability to indent or outdent current list when user press Alt+shift+Right\n */\nconst IndentWhenAltShiftRight: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.RIGHT],\n    shouldHandleEvent: shouldHandleIndentationEvent(true),\n    handleEvent: handleIndentationEvent(true),\n    allowFunctionKeys: true,\n    defaultDisabled: Browser.isMac,\n};\n\n/**\n * outdentWhenAltShiftLeft edit feature, provides the ability to indent or outdent current list when user press Alt+shift+Left\n */\nconst OutdentWhenAltShiftLeft: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.LEFT],\n    shouldHandleEvent: shouldHandleIndentationEvent(false),\n    handleEvent: handleIndentationEvent(false),\n    allowFunctionKeys: true,\n    defaultDisabled: Browser.isMac,\n};\n\n/**\n * MergeInNewLine edit feature, provides the ability to merge current line into a new line when user press\n * BACKSPACE at beginning of a list item\n */\nconst MergeInNewLine: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.BACKSPACE],\n    shouldHandleEvent: (event, editor) => {\n        const li = editor.getElementAtCursor('LI', undefined /*startFrom*/, event);\n        const range = editor.getSelectionRange();\n        return li && range?.collapsed && isPositionAtBeginningOf(Position.getStart(range), li);\n    },\n    handleEvent: (event, editor) => {\n        const li = editor.getElementAtCursor('LI', undefined /*startFrom*/, event);\n        if (li?.previousSibling) {\n            blockFormat(editor, (region, start, end) => {\n                const vList = createVListFromRegion(\n                    region,\n                    false /*includeSiblingList*/,\n                    li ?? undefined\n                );\n                if (vList && start && end) {\n                    vList.setIndentation(start, end, Indentation.Decrease, true /*softOutdent*/);\n                    vList.writeBack(\n                        editor.isFeatureEnabled(ExperimentalFeatures.ReuseAllAncestorListElements),\n                        editor.isFeatureEnabled(ExperimentalFeatures.DisableListChain)\n                    );\n                    event.rawEvent.preventDefault();\n                }\n            });\n        } else {\n            toggleListAndPreventDefault(event, editor);\n        }\n    },\n    defaultDisabled: true,\n};\n\n/**\n * OutdentWhenBackOn1stEmptyLine edit feature, provides the ability to outdent current item if user press\n * BACKSPACE at the first and empty line of a list\n */\nconst OutdentWhenBackOn1stEmptyLine: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.BACKSPACE],\n    shouldHandleEvent: (event, editor) => {\n        const li = editor.getElementAtCursor('LI', undefined /*startFrom*/, event);\n        return (\n            li &&\n            isNodeEmpty(li) &&\n            !li.previousSibling &&\n            !li.getElementsByTagName('blockquote').length\n        );\n    },\n    handleEvent: toggleListAndPreventDefault,\n};\n\n/**\n * MaintainListChainWhenDelete edit feature, provides the ability to indent the list if user press\n * DELETE before the first item of a list\n */\nconst MaintainListChainWhenDelete: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.DELETE],\n    shouldHandleEvent: (event, editor) => {\n        const li = editor.getElementAtCursor('LI', undefined /*startFrom*/, event);\n        const range = editor.getSelectionRange();\n        if (li || !range) {\n            return false;\n        }\n        const isAtEnd = Position.getEnd(range).isAtEnd;\n        const nextSibling = isAtEnd ? getCacheNextSibling(event, editor) : undefined;\n        const isAtEndAndBeforeLI = editor.getElementAtCursor('LI', nextSibling, event);\n        return isAtEndAndBeforeLI;\n    },\n    handleEvent: (event, editor) => {\n        const chains = getListChains(editor);\n        editor.runAsync(editor => commitListChains(editor, chains));\n    },\n};\n\n/**\n * OutdentWhenEnterOnEmptyLine edit feature, provides the ability to outdent current item if user press\n * ENTER at the beginning of an empty line of a list\n */\nconst OutdentWhenEnterOnEmptyLine: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.ENTER],\n    shouldHandleEvent: (event, editor) => {\n        const li = editor.getElementAtCursor('LI', undefined /*startFrom*/, event);\n        return !event.rawEvent.shiftKey && li && isNodeEmpty(li);\n    },\n    handleEvent: (event, editor) => {\n        editor.addUndoSnapshot(\n            () => toggleListAndPreventDefault(event, editor, false /* includeSiblingLists */),\n            undefined /*changeSource*/,\n            true /*canUndoByBackspace*/\n        );\n    },\n    defaultDisabled: !Browser.isIE && !Browser.isChrome,\n};\n\n/**\n * @deprecated Use AutoBulletList and AutoNumberingList instead\n */\nconst AutoBullet: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.SPACE],\n    shouldHandleEvent: (event, editor) => {\n        return false;\n    },\n    handleEvent: (event, editor) => {},\n    defaultDisabled: true,\n};\n\n/**\n * AutoBulletList edit feature, provides the ability to automatically convert current line into a bullet list.\n */\nconst AutoBulletList: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.SPACE],\n    shouldHandleEvent: (event, editor) => {\n        if (!cacheGetListElement(event, editor)) {\n            return shouldTriggerList(event, editor, getAutoBulletListStyle, ListType.Unordered);\n        }\n        return false;\n    },\n    handleEvent: (event, editor) => {\n        editor.insertContent('&nbsp;');\n        event.rawEvent.preventDefault();\n        editor.addUndoSnapshot(\n            () => {\n                const searcher = editor.getContentSearcherOfCursor();\n                if (!searcher) {\n                    return;\n                }\n                const textBeforeCursor = searcher.getSubStringBefore(5);\n                const textRange = searcher.getRangeFromText(textBeforeCursor, true /*exactMatch*/);\n                const listStyle = getAutoBulletListStyle(textBeforeCursor);\n\n                if (textRange) {\n                    prepareAutoBullet(editor, textRange);\n                    toggleBullet(\n                        editor,\n                        listStyle ?? undefined,\n                        'autoToggleList' /** apiNameOverride */\n                    );\n                }\n                searcher.getRangeFromText(textBeforeCursor, true /*exactMatch*/)?.deleteContents();\n            },\n            undefined /*changeSource*/,\n            true /*canUndoByBackspace*/\n        );\n    },\n};\n\n/**\n * AutoNumberingList edit feature, provides the ability to automatically convert current line into a numbering list.\n */\nconst AutoNumberingList: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.SPACE],\n    shouldHandleEvent: (event, editor) => {\n        if (!cacheGetListElement(event, editor)) {\n            return shouldTriggerList(event, editor, getAutoNumberingListStyle, ListType.Ordered);\n        }\n        return false;\n    },\n    handleEvent: (event, editor) => {\n        editor.insertContent('&nbsp;');\n        event.rawEvent.preventDefault();\n        editor.addUndoSnapshot(\n            () => {\n                const searcher = editor.getContentSearcherOfCursor();\n                if (!searcher) {\n                    return;\n                }\n                const textBeforeCursor = searcher.getSubStringBefore(5);\n                const textRange = searcher.getRangeFromText(textBeforeCursor, true /*exactMatch*/);\n\n                if (textRange) {\n                    const number = isFirstItemOfAList(textBeforeCursor)\n                        ? 1\n                        : parseInt(textBeforeCursor);\n\n                    const isLi = getPreviousListItem(editor, textRange);\n                    const listStyle = getAutoNumberingListStyle(textBeforeCursor) ?? undefined;\n                    prepareAutoBullet(editor, textRange);\n                    toggleNumbering(\n                        editor,\n                        isLi && number !== 1 ? undefined : number /** startNumber */,\n                        listStyle,\n                        'autoToggleList' /** apiNameOverride */\n                    );\n                }\n                searcher.getRangeFromText(textBeforeCursor, true /*exactMatch*/)?.deleteContents();\n            },\n            undefined /*changeSource*/,\n            true /*canUndoByBackspace*/\n        );\n    },\n};\n\nconst getPreviousListItem = (editor: IEditor, textRange: Range) => {\n    const blockElement = editor\n        .getBodyTraverser(textRange?.startContainer)\n        .getPreviousBlockElement();\n    const previousNode = blockElement?.getEndNode() ?? null;\n    return getTagOfNode(previousNode) === 'LI' ? previousNode : undefined;\n};\n\nconst getPreviousListType = (editor: IEditor, textRange: Range, listType: ListType) => {\n    const type = listType === ListType.Ordered ? 'orderedStyleType' : 'unorderedStyleType';\n    const listItem = getPreviousListItem(editor, textRange);\n    const list = listItem\n        ? findClosestElementAncestor(\n              listItem,\n              undefined /** root*/,\n              listType === ListType.Ordered ? 'ol' : 'ul'\n          )\n        : null;\n    const metadata = list ? getMetadata(list, ListStyleDefinitionMetadata) : null;\n    return metadata ? metadata[type] : null;\n};\n\nconst isFirstItemOfAList = (item: string) => {\n    const number = parseInt(item);\n    if (number && number === 1) {\n        return 1;\n    } else {\n        const letter = item.replace(/\\(|\\)|\\-|\\./g, '').trim();\n        return letter.length === 1 && ['i', 'a', 'I', 'A'].indexOf(letter) > -1 ? 1 : undefined;\n    }\n};\n\n/**\n * Maintain the list numbers in list chain\n * e.g. we have two lists:\n * 1, 2, 3 and 4, 5, 6\n * Now we delete list item 2, so the first one becomes \"1, 2\".\n * This edit feature can maintain the list number of the second list to become \"3, 4, 5\"\n */\nconst MaintainListChain: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.ENTER, Keys.TAB, Keys.DELETE, Keys.BACKSPACE, Keys.RANGE],\n    shouldHandleEvent: (event, editor) =>\n        editor\n            .queryElements('li', QueryScope.OnSelection)\n            .filter(li => !li.getElementsByTagName('blockquote').length).length > 0,\n    handleEvent: (event, editor) => {\n        const chains = getListChains(editor);\n        editor.runAsync(editor => commitListChains(editor, chains));\n    },\n};\n\nfunction getListChains(editor: IEditor) {\n    return VListChain.createListChains(editor.getSelectedRegions());\n}\n\nfunction getCacheNextSibling(event: PluginKeyboardEvent, editor: IEditor): Node | undefined {\n    const element = cacheGetEventData(event, 'nextSibling', () => {\n        const range = editor.getSelectionRange();\n        const pos = range && Position.getEnd(range).normalize();\n        const traverser = pos && editor.getBodyTraverser(pos.node);\n        return traverser?.getNextBlockElement()?.getStartNode();\n    });\n    return element;\n}\n\nfunction prepareAutoBullet(editor: IEditor, range: Range) {\n    const block = editor.getBlockElementAtNode(range.startContainer);\n    const endNode = block?.getEndNode();\n    if (endNode && getTagOfNode(endNode) != 'BR') {\n        const br = editor.getDocument().createElement('BR');\n        if (isBlockElement(endNode)) {\n            endNode.appendChild(br);\n        } else {\n            endNode.parentNode?.insertBefore(br, endNode.nextSibling);\n        }\n        editor.select(range.startContainer, range.startOffset);\n    }\n}\n\nfunction toggleListAndPreventDefault(\n    event: PluginKeyboardEvent,\n    editor: IEditor,\n    includeSiblingLists: boolean = true\n) {\n    const listInfo = cacheGetListElement(event, editor);\n    if (listInfo) {\n        const listElement = listInfo[0];\n        const tag = getTagOfNode(listElement);\n\n        if (tag == 'UL' || tag == 'OL') {\n            toggleListType(\n                editor,\n                tag == 'UL' ? ListType.Unordered : ListType.Ordered,\n                undefined /* startNumber */,\n                includeSiblingLists\n            );\n        }\n\n        editor.focus();\n        event.rawEvent.preventDefault();\n    }\n}\n\nfunction cacheGetListElement(event: PluginKeyboardEvent, editor: IEditor) {\n    const li = editor.getElementAtCursor('LI,TABLE', undefined /*startFrom*/, event);\n    const listElement = li && getTagOfNode(li) == 'LI' && editor.getElementAtCursor('UL,OL', li);\n    return listElement ? [listElement, li] : null;\n}\n\nfunction shouldTriggerList<\n    T extends ListType,\n    K extends T extends ListType.Ordered ? NumberingListType : BulletListType\n>(\n    event: PluginKeyboardEvent,\n    editor: IEditor,\n    getListStyle: (\n        text: string,\n        previousListChain?: VListChain[],\n        previousListStyle?: K\n    ) => K | null,\n    listType: T\n) {\n    const searcher = editor.getContentSearcherOfCursor(event);\n    if (!searcher) {\n        return false;\n    }\n    const textBeforeCursor = searcher.getSubStringBefore(4);\n    const traverser = editor.getBlockTraverser();\n    const text =\n        traverser && traverser.currentBlockElement\n            ? traverser.currentBlockElement.getTextContent().slice(0, textBeforeCursor.length)\n            : null;\n    const isATheBeginning = text && text === textBeforeCursor;\n    const listChains = getListChains(editor);\n    const textRange = searcher.getRangeFromText(textBeforeCursor, true /*exactMatch*/);\n    const previousListType =\n        textRange && <K | null>getPreviousListType(editor, textRange, listType);\n    const isFirstItem = isFirstItemOfAList(textBeforeCursor);\n    const listStyle = getListStyle(textBeforeCursor, listChains, previousListType ?? undefined);\n    const shouldTriggerNewListStyle =\n        isFirstItem ||\n        !previousListType ||\n        previousListType === listStyle ||\n        listType === ListType.Unordered;\n\n    return (\n        isATheBeginning &&\n        !searcher.getNearestNonTextInlineElement() &&\n        listStyle &&\n        shouldTriggerNewListStyle\n    );\n}\n\n/**\n * MergeListOnBackspaceAfterList edit feature, provides the ability to merge list on backspace on block after a list.\n */\nconst MergeListOnBackspaceAfterList: BuildInEditFeature<PluginKeyboardEvent> = {\n    keys: [Keys.BACKSPACE],\n    shouldHandleEvent: (event, editor) => {\n        const target = editor.getElementAtCursor();\n        if (target) {\n            const cursorBlock = editor.getBlockElementAtNode(target)?.getStartNode() as HTMLElement;\n            const previousBlock = cursorBlock?.previousElementSibling ?? null;\n\n            if (isList(previousBlock)) {\n                const range = editor.getSelectionRange();\n                const searcher = editor.getContentSearcherOfCursor(event);\n                const textBeforeCursor = searcher?.getSubStringBefore(4);\n                const nearestInline = searcher?.getNearestNonTextInlineElement();\n\n                if (range && range.collapsed && textBeforeCursor === '' && !nearestInline) {\n                    const tempBlock = cursorBlock?.nextElementSibling;\n                    const nextBlock = isList(tempBlock) ? tempBlock : tempBlock?.firstChild;\n\n                    if (\n                        isList(nextBlock) &&\n                        getTagOfNode(previousBlock) == getTagOfNode(nextBlock)\n                    ) {\n                        const element = cacheGetEventData<HTMLOListElement | HTMLUListElement>(\n                            event,\n                            PREVIOUS_BLOCK_CACHE_KEY,\n                            () => previousBlock\n                        );\n                        const nextElement = cacheGetEventData<HTMLOListElement | HTMLUListElement>(\n                            event,\n                            NEXT_BLOCK_CACHE_KEY,\n                            () => nextBlock\n                        );\n\n                        return !!element && !!nextElement;\n                    }\n                }\n            }\n        }\n\n        return false;\n    },\n    handleEvent: (event, editor) => {\n        editor.runAsync(editor => {\n            const previousList = cacheGetEventData<HTMLOListElement | HTMLUListElement | null>(\n                event,\n                PREVIOUS_BLOCK_CACHE_KEY,\n                () => null\n            );\n            const targetBlock = cacheGetEventData<HTMLOListElement | HTMLUListElement | null>(\n                event,\n                NEXT_BLOCK_CACHE_KEY,\n                () => null\n            );\n\n            const rangeBeforeWriteBack = editor.getSelectionRange();\n\n            if (previousList && targetBlock && rangeBeforeWriteBack) {\n                const fvList = new VList(previousList);\n                fvList.mergeVList(new VList(targetBlock));\n\n                let span = editor.getDocument().createElement('span');\n                span.id = 'restoreRange';\n                rangeBeforeWriteBack.insertNode(span);\n\n                fvList.writeBack();\n\n                span = editor.queryElements('#restoreRange')[0];\n\n                if (span.parentElement) {\n                    editor.select(new Position(span, PositionType.After));\n                    span.parentElement.removeChild(span);\n                }\n            }\n        });\n    },\n};\n\n/**\n * @internal\n */\nexport const ListFeatures: Record<\n    keyof ListFeatureSettings,\n    BuildInEditFeature<PluginKeyboardEvent>\n> = {\n    autoBullet: AutoBullet,\n    indentWhenTab: IndentWhenTab,\n    outdentWhenShiftTab: OutdentWhenShiftTab,\n    outdentWhenBackspaceOnEmptyFirstLine: OutdentWhenBackOn1stEmptyLine,\n    outdentWhenEnterOnEmptyLine: OutdentWhenEnterOnEmptyLine,\n    mergeInNewLineWhenBackspaceOnFirstChar: MergeInNewLine,\n    maintainListChain: MaintainListChain,\n    maintainListChainWhenDelete: MaintainListChainWhenDelete,\n    autoNumberingList: AutoNumberingList,\n    autoBulletList: AutoBulletList,\n    mergeListOnBackspaceAfterList: MergeListOnBackspaceAfterList,\n    outdentWhenAltShiftLeft: OutdentWhenAltShiftLeft,\n    indentWhenAltShiftRight: IndentWhenAltShiftRight,\n};\n\nfunction isList(element: Node | null | undefined): element is HTMLOListElement | HTMLOListElement {\n    return (\n        !!element &&\n        (safeInstanceOf(element, 'HTMLOListElement') || safeInstanceOf(element, 'HTMLUListElement'))\n    );\n}\n"]}