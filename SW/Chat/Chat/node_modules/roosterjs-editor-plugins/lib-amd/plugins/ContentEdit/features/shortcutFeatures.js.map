{"version":3,"file":"shortcutFeatures.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/ContentEdit/features/shortcutFeatures.ts"],"names":[],"mappings":";;;;IAwBA,SAAS,aAAa,CAClB,MAAc,EACd,MAAc,EACd,MAAgC,EAChC,QAAyB;QAAzB,yBAAA,EAAA,gBAAyB;QAEzB,IAAI,QAAQ,EAAE;YACV,OAAO,IAAI,CAAC;SACf;QACD,OAAO;YACH,MAAM,QAAA;YACN,MAAM,QAAA;YACN,MAAM,QAAA;SACT,CAAC;IACN,CAAC;IAED,IAAM,QAAQ,GAAsB;QAChC,aAAa,CAAC,4BAAkB,EAAE,4BAAkB,EAAE,iCAAU,CAAC;QACjE,aAAa,CAAC,4BAAkB,EAAE,4BAAkB,EAAE,mCAAY,CAAC;QACnE,aAAa,CAAC,4BAAkB,EAAE,4BAAkB,EAAE,sCAAe,CAAC;QACtE,aAAa,CAAC,gCAAsB,EAAE,gCAAsB,EAAE,kCAAW,CAAC;QAC1E,aAAa,CAAC,4BAAkB,EAAE,4BAAkB,EAAE,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,EAAE,EAAb,CAAa,CAAC;QAC9E,aAAa,CACT,gCAAyB,EACzB,gCAAyB,EACzB,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,EAAE,EAAb,CAAa,EACvB,8BAAO,CAAC,KAAK,CAAC,uDAAuD,CACxE;QACD,aAAa,CAAC,4BAAkB,EAAE,mCAAsB,aAAS,EAAE,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,EAAE,EAAb,CAAa,CAAC;QAC3F,aAAa,CAAC,kCAAuB,EAAE,kCAAuB,EAAE,mCAAY,CAAC;QAC7E,aAAa,CAAC,yCAA8B,EAAE,yCAA8B,EAAE,sCAAe,CAAC;QAC9F,aAAa,CACT,mCAAsB,mBAAc,EACpC,mCAAsB,mBAAc,EACpC,UAAA,MAAM,IAAI,OAAA,IAAA,qCAAc,EAAC,MAAM,mBAA0B,EAA/C,CAA+C,CAC5D;QACD,aAAa,CACT,mCAAsB,kBAAa,EACnC,mCAAsB,kBAAa,EACnC,UAAA,MAAM,IAAI,OAAA,IAAA,qCAAc,EAAC,MAAM,mBAA0B,EAA/C,CAA+C,CAC5D;KACJ,CAAC,MAAM,CAAC,UAAC,OAAO,IAAiC,OAAA,CAAC,CAAC,OAAO,EAAT,CAAS,CAAC,CAAC;IAE7D;;;;;;;;;;;;;OAaG;IACH,IAAM,eAAe,GAA4C;QAC7D,iBAAiB,EAAE,IAAI;QACvB,IAAI,EAAE;;;;;;;;;;;SAWL;QACD,iBAAiB,EAAE,eAAe;QAClC,WAAW,EAAE,UAAC,KAAK,EAAE,MAAM;YACvB,IAAM,OAAO,GAAG,eAAe,CAAC,KAAK,CAAC,CAAC;YACvC,IAAI,OAAO,EAAE;gBACT,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACvB,KAAK,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;gBAChC,KAAK,CAAC,QAAQ,CAAC,eAAe,EAAE,CAAC;aACpC;QACL,CAAC;KACJ,CAAC;IAEF,SAAS,eAAe,CAAC,KAA0B;QAC/C,OAAO,IAAA,wCAAiB,EAAC,KAAK,EAAE,uBAAuB,EAAE;YACrD,IAAM,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC;YACzB,IAAM,GAAG;YACL,0FAA0F;YAC1F,4FAA4F;YAC5F,0FAA0F;YAC1F,iCAAiC;YACjC,KAAK,CAAC,SAAS,mBAA2B,IAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,UAAU,CAAC;gBACzE,CAAC,CAAC,CAAC,CAAC,KAAK;oBACE,CAAC,CAAC,CAAC,OAAO,mBAAa,CAAE;oBACzB,CAAC,CAAC,CAAC,QAAQ,qBAAc,CAAE;oBAC3B,CAAC,CAAC,CAAC,OAAO,mBAAa,CAAE;oBACzB,CAAC,CAAC,CAAC,MAAM,gBAAY,CAAE;gBAClC,CAAC,CAAC,CAAC,CAAC;YACZ,OAAO,GAAG,IAAI,QAAQ,CAAC,MAAM,CAAC,UAAA,GAAG,IAAI,OAAA,CAAC,8BAAO,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,GAAG,EAAhD,CAAgD,CAAC,CAAC,CAAC,CAAC,CAAC;QAC9F,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;OAEG;IACU,QAAA,gBAAgB,GAGzB;QACA,eAAe,EAAE,eAAe;KACnC,CAAC","sourcesContent":["import { Browser, cacheGetEventData } from 'roosterjs-editor-dom';\nimport { FontSizeChange, Keys, PluginEventType } from 'roosterjs-editor-types';\nimport type {\n    BuildInEditFeature,\n    IEditor,\n    PluginKeyboardEvent,\n    ShortcutFeatureSettings,\n} from 'roosterjs-editor-types';\nimport {\n    changeFontSize,\n    toggleBold,\n    toggleItalic,\n    toggleUnderline,\n    toggleBullet,\n    toggleNumbering,\n    clearFormat,\n} from 'roosterjs-editor-api';\n\ninterface ShortcutCommand {\n    winKey: number;\n    macKey: number;\n    action: (editor: IEditor) => any;\n}\n\nfunction createCommand(\n    winKey: number,\n    macKey: number,\n    action: (editor: IEditor) => any,\n    disabled: boolean = false\n) {\n    if (disabled) {\n        return null;\n    }\n    return {\n        winKey,\n        macKey,\n        action,\n    };\n}\n\nconst commands: ShortcutCommand[] = [\n    createCommand(Keys.Ctrl | Keys.B, Keys.Meta | Keys.B, toggleBold),\n    createCommand(Keys.Ctrl | Keys.I, Keys.Meta | Keys.I, toggleItalic),\n    createCommand(Keys.Ctrl | Keys.U, Keys.Meta | Keys.U, toggleUnderline),\n    createCommand(Keys.Ctrl | Keys.SPACE, Keys.Meta | Keys.SPACE, clearFormat),\n    createCommand(Keys.Ctrl | Keys.Z, Keys.Meta | Keys.Z, editor => editor.undo()),\n    createCommand(\n        Keys.ALT | Keys.BACKSPACE,\n        Keys.ALT | Keys.BACKSPACE,\n        editor => editor.undo(),\n        Browser.isMac /* Option+Backspace to be handled by browsers on Mac */\n    ),\n    createCommand(Keys.Ctrl | Keys.Y, Keys.Meta | Keys.Shift | Keys.Z, editor => editor.redo()),\n    createCommand(Keys.Ctrl | Keys.PERIOD, Keys.Meta | Keys.PERIOD, toggleBullet),\n    createCommand(Keys.Ctrl | Keys.FORWARD_SLASH, Keys.Meta | Keys.FORWARD_SLASH, toggleNumbering),\n    createCommand(\n        Keys.Ctrl | Keys.Shift | Keys.PERIOD,\n        Keys.Meta | Keys.Shift | Keys.PERIOD,\n        editor => changeFontSize(editor, FontSizeChange.Increase)\n    ),\n    createCommand(\n        Keys.Ctrl | Keys.Shift | Keys.COMMA,\n        Keys.Meta | Keys.Shift | Keys.COMMA,\n        editor => changeFontSize(editor, FontSizeChange.Decrease)\n    ),\n].filter((command): command is ShortcutCommand => !!command);\n\n/**\n * DefaultShortcut edit feature, provides shortcuts for the following features:\n * Ctrl/Meta+B: toggle bold style\n * Ctrl/Meta+I: toggle italic style\n * Ctrl/Meta+U: toggle underline style\n * Ctrl/Meta+Space: clear formatting\n * Alt+Backspace: undo\n * Ctrl/Meta+Z: undo\n * Ctrl+Y/Meta+Shift+Z: redo\n * Ctrl/Meta+PERIOD: toggle bullet list\n * Ctrl/Meta+/: toggle numbering list\n * Ctrl/Meta+Shift+>: increase font size\n * Ctrl/Meta+Shift+<: decrease font size\n */\nconst DefaultShortcut: BuildInEditFeature<PluginKeyboardEvent> = {\n    allowFunctionKeys: true,\n    keys: [\n        Keys.B,\n        Keys.I,\n        Keys.U,\n        Keys.Y,\n        Keys.Z,\n        Keys.COMMA,\n        Keys.PERIOD,\n        Keys.FORWARD_SLASH,\n        Keys.SPACE,\n        Keys.BACKSPACE,\n    ],\n    shouldHandleEvent: cacheGetCommand,\n    handleEvent: (event, editor) => {\n        const command = cacheGetCommand(event);\n        if (command) {\n            command.action(editor);\n            event.rawEvent.preventDefault();\n            event.rawEvent.stopPropagation();\n        }\n    },\n};\n\nfunction cacheGetCommand(event: PluginKeyboardEvent) {\n    return cacheGetEventData(event, 'DEFAULT_SHORT_COMMAND', () => {\n        const e = event.rawEvent;\n        const key =\n            // Need to check AltGraph isn't being pressed since some languages (e.g. Polski) use AltGr\n            // to input some special characters. In that case, ctrlKey and altKey are both true in Edge,\n            // but we should not trigger any shortcut function here. However, we still want to capture\n            // the ALT+BACKSPACE combination.\n            event.eventType == PluginEventType.KeyDown && !e.getModifierState('AltGraph')\n                ? e.which |\n                  (<number>(e.metaKey && Keys.Meta)) |\n                  (<number>(e.shiftKey && Keys.Shift)) |\n                  (<number>(e.ctrlKey && Keys.Ctrl)) |\n                  (<number>(e.altKey && Keys.ALT))\n                : 0;\n        return key && commands.filter(cmd => (Browser.isMac ? cmd.macKey : cmd.winKey) == key)[0];\n    });\n}\n\n/**\n * @internal\n */\nexport const ShortcutFeatures: Record<\n    keyof ShortcutFeatureSettings,\n    BuildInEditFeature<PluginKeyboardEvent>\n> = {\n    defaultShortcut: DefaultShortcut,\n};\n"]}