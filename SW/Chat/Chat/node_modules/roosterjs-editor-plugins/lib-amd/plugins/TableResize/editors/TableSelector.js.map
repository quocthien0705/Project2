{"version":3,"file":"TableSelector.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/TableResize/editors/TableSelector.ts"],"names":[],"mappings":"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","sourcesContent":["import DragAndDropHelper from '../../../pluginUtils/DragAndDropHelper';\nimport type DragAndDropHandler from '../../../pluginUtils/DragAndDropHandler';\nimport type TableEditorFeature from './TableEditorFeature';\nimport type { CreateElementData, IEditor, Rect } from 'roosterjs-editor-types';\nimport {\n    createElement,\n    normalizeRect,\n    safeInstanceOf,\n    getComputedStyle,\n} from 'roosterjs-editor-dom';\n\nconst TABLE_SELECTOR_LENGTH = 12;\nconst TABLE_SELECTOR_ID = '_Table_Selector';\n\n/**\n * @internal\n */\nexport default function createTableSelector(\n    table: HTMLTableElement,\n    editor: IEditor,\n    onFinishDragging: (table: HTMLTableElement) => void,\n    getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n    onShowHelperElement?: (\n        elementData: CreateElementData,\n        helperType: 'CellResizer' | 'TableInserter' | 'TableResizer' | 'TableSelector',\n        table: HTMLTableElement\n    ) => void,\n    contentDiv?: EventTarget | null,\n    anchorContainer?: HTMLElement\n): TableEditorFeature | null {\n    const rect = normalizeRect(table.getBoundingClientRect());\n\n    if (!isTableTopVisible(editor, rect, contentDiv)) {\n        return null;\n    }\n\n    const zoomScale = editor.getZoomScale();\n    const document = table.ownerDocument;\n    const createElementData = {\n        tag: 'div',\n        style: 'position: fixed; cursor: all-scroll; user-select: none; border: 1px solid #808080',\n    };\n\n    onShowHelperElement?.(createElementData, 'TableSelector', table);\n\n    const div = createElement(createElementData, document) as HTMLDivElement;\n\n    div.id = TABLE_SELECTOR_ID;\n    div.style.width = `${TABLE_SELECTOR_LENGTH}px`;\n    div.style.height = `${TABLE_SELECTOR_LENGTH}px`;\n\n    (anchorContainer || document.body).appendChild(div);\n\n    const context: TableSelectorContext = {\n        table,\n        zoomScale,\n        rect,\n        isRTL: getComputedStyle(table, 'direction') == 'rtl',\n    };\n\n    setDivPosition(context, div);\n\n    const onDragEnd = (context: TableSelectorContext, event: MouseEvent): false => {\n        if (event.target == div) {\n            onFinishDragging(context.table);\n        }\n        return false;\n    };\n\n    const featureHandler = new TableSelectorFeature(\n        div,\n        context,\n        setDivPosition,\n        {\n            onDragEnd,\n        },\n        context.zoomScale,\n        getOnMouseOut\n    );\n\n    return { div, featureHandler, node: table };\n}\n\ninterface TableSelectorContext {\n    table: HTMLTableElement;\n    zoomScale: number;\n    rect: Rect | null;\n    isRTL: boolean;\n}\n\ninterface TableSelectorInitValue {\n    event: MouseEvent;\n}\n\nclass TableSelectorFeature extends DragAndDropHelper<TableSelectorContext, TableSelectorInitValue> {\n    private onMouseOut: ((ev: MouseEvent) => void) | null;\n\n    constructor(\n        private div: HTMLElement,\n        context: TableSelectorContext,\n        onSubmit: (\n            context: TableSelectorContext,\n            trigger: HTMLElement,\n            container?: HTMLElement\n        ) => void,\n        handler: DragAndDropHandler<TableSelectorContext, TableSelectorInitValue>,\n        zoomScale: number,\n        getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n        forceMobile?: boolean | undefined,\n        container?: HTMLElement\n    ) {\n        super(div, context, onSubmit, handler, zoomScale, forceMobile);\n        this.onMouseOut = getOnMouseOut(div);\n        div.addEventListener('mouseout', this.onMouseOut);\n    }\n\n    dispose(): void {\n        super.dispose();\n        if (this.onMouseOut) {\n            this.div.removeEventListener('mouseout', this.onMouseOut);\n        }\n        this.onMouseOut = null;\n    }\n}\n\nfunction setDivPosition(context: TableSelectorContext, trigger: HTMLElement) {\n    const { rect } = context;\n    if (rect) {\n        trigger.style.top = `${rect.top - TABLE_SELECTOR_LENGTH}px`;\n        trigger.style.left = `${rect.left - TABLE_SELECTOR_LENGTH - 2}px`;\n    }\n}\n\nfunction isTableTopVisible(\n    editor: IEditor,\n    rect: Rect | null,\n    contentDiv?: EventTarget | null\n): boolean {\n    const visibleViewport = editor.getVisibleViewport();\n    if (contentDiv && safeInstanceOf(contentDiv, 'HTMLElement') && visibleViewport && rect) {\n        const containerRect = normalizeRect(contentDiv.getBoundingClientRect());\n\n        return !!containerRect && containerRect.top <= rect.top && visibleViewport.top <= rect.top;\n    }\n\n    return true;\n}\n"]}