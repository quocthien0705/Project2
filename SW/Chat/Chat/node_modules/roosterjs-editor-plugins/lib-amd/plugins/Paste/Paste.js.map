{"version":3,"file":"Paste.js","sourceRoot":"","sources":["../../../../../packages/roosterjs-editor-plugins/lib/plugins/Paste/Paste.ts"],"names":[],"mappings":";;;IAmBA,IAAM,sBAAsB,GAAG,2BAA2B,CAAC;IAE3D;;;;;OAKG;IACH;QAGI;;;;;WAKG;QACH,eACY,qBAAsC,EACtC,sBAAuC;YADvC,sCAAA,EAAA,8BAAsC;YACtC,uCAAA,EAAA,8BAAuC;YADvC,0BAAqB,GAArB,qBAAqB,CAAiB;YACtC,2BAAsB,GAAtB,sBAAsB,CAAiB;YAV3C,WAAM,GAAmB,IAAI,CAAC;QAWnC,CAAC;QAEJ;;WAEG;QACH,uBAAO,GAAP;YACI,OAAO,OAAO,CAAC;QACnB,CAAC;QAED;;;WAGG;QACH,0BAAU,GAAV,UAAW,MAAe;YACtB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACzB,CAAC;QAED;;WAEG;QACH,uBAAO,GAAP;YACI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACvB,CAAC;QAED;;;WAGG;QACH,6BAAa,GAAb,UAAc,KAAkB;YAC5B,IAAI,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC,SAAS,wBAA+B,EAAE;gBACvD,IAAA,QAAQ,GAAuB,KAAK,SAA5B,EAAE,gBAAgB,GAAK,KAAK,iBAAV,CAAW;gBAC7C,IAAM,kBAAkB,GAAG,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC;gBAE/D,QAAQ,IAAA,qCAAc,EAAC,KAAK,EAAE,IAAI,CAAC,sBAAsB,CAAC,EAAE;oBACxD;wBACI,+BAA+B;wBAC/B,IAAA,sCAA4B,EAAC,KAAK,CAAC,CAAC;wBACpC,MAAM;oBACV,0BAAuC;oBACvC;wBACI,IACI,KAAK,CAAC,SAAS,mBAAqB;4BACpC,KAAK,CAAC,SAAS,wBAA0B,EAC3C;4BACE,gCAAgC;4BAChC,IAAA,uCAA6B,EAAC,KAAK,EAAE,kBAAkB,CAAC,CAAC;yBAC5D;wBACD,MAAM;oBACV;wBACI,IAAA,4CAAkC,EAAC,KAAK,EAAE,kBAAkB,CAAC,CAAC;wBAC9D,MAAM;oBACV;wBACI,IAAA,8CAAoC,EAAC,QAAQ,EAAE,gBAAgB,CAAC,CAAC;wBACjE,MAAM;oBACV;wBACI,gBAAgB,CAAC,yBAAyB,CAAC,sBAAsB,CAAC,GAAG,GAAG,CAAC;wBACzE,MAAM;oBACV;wBACI,IAAA,2CAAiC,EAAC,KAAK,EAAE,kBAAkB,CAAC,CAAC;wBAC7D,MAAM;oBACV;wBACI,IAAA,mCAAyB,EAAC,QAAQ,CAAC,CAAC;wBACpC,IAAA,yBAAe,EAAC,QAAQ,CAAC,CAAC;wBAC1B,MAAM;iBACb;gBACD,IAAA,uBAAa,EAAC,gBAAgB,CAAC,CAAC;gBAChC,IAAA,6CAAmC,EAAC,gBAAgB,CAAC,CAAC;gBACtD,mBAAmB,CAAC,gBAAgB,CAAC,CAAC;gBAEtC,iCAAiC;gBACjC,gBAAgB,CAAC,qBAAqB,GAAG,IAAI,CAAC,qBAAqB,CAAC;aACvE;QACL,CAAC;QACL,YAAC;IAAD,CAAC,AArFD,IAqFC;;IAED,SAAS,mBAAmB,CAAC,gBAAgD;QACzE,IAAA,6CAAsB,EAAC,gBAAgB,CAAC,iBAAiB,EAAE,SAAS,EAAE,UAAC,KAAa;YAChF,OAAO,KAAK,IAAI,MAAM,CAAC,CAAC,mCAAmC;QAC/D,CAAC,CAAC,CAAC;IACP,CAAC","sourcesContent":["import convertPasteContentForSingleImage from './imageConverter/convertPasteContentForSingleImage';\nimport convertPastedContentForLI from './commonConverter/convertPastedContentForLI';\nimport convertPastedContentFromExcel from './excelConverter/convertPastedContentFromExcel';\nimport convertPastedContentFromOfficeOnline from './officeOnlineConverter/convertPastedContentFromOfficeOnline';\nimport convertPastedContentFromPowerPoint from './pptConverter/convertPastedContentFromPowerPoint';\nimport convertPastedContentFromWord from './wordConverter/convertPastedContentFromWord';\nimport handleLineMerge from './lineMerge/handleLineMerge';\nimport sanitizeHtmlColorsFromPastedContent from './sanitizeHtmlColorsFromPastedContent/sanitizeHtmlColorsFromPastedContent';\nimport sanitizeLinks from './sanitizeLinks/sanitizeLinks';\nimport { chainSanitizerCallback, getPasteSource } from 'roosterjs-editor-dom';\nimport { KnownPasteSourceType, PasteType, PluginEventType } from 'roosterjs-editor-types';\n\nimport type {\n    HtmlSanitizerOptions,\n    EditorPlugin,\n    IEditor,\n    PluginEvent,\n} from 'roosterjs-editor-types';\n\nconst GOOGLE_SHEET_NODE_NAME = 'google-sheets-html-origin';\n\n/**\n * Paste plugin, handles BeforePaste event and reformat some special content, including:\n * 1. Content copied from Word\n * 2. Content copied from Excel\n * 3. Content copied from Word Online or OneNote Online\n */\nexport default class Paste implements EditorPlugin {\n    private editor: IEditor | null = null;\n\n    /**\n     * Construct a new instance of Paste class\n     * @param unknownTagReplacement Replace solution of unknown tags, default behavior is to replace with SPAN\n     * @param convertSingleImageBody When enabled, if clipboard HTML contains a single image, we reuse the image without modifying the src attribute.\n     *                               When disabled, pasted image src attribute will use the dataUri from clipboard data -- By Default disabled.\n     */\n    constructor(\n        private unknownTagReplacement: string = 'SPAN',\n        private convertSingleImageBody: boolean = false\n    ) {}\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'Paste';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor && event.eventType == PluginEventType.BeforePaste) {\n            const { fragment, sanitizingOption } = event;\n            const trustedHTMLHandler = this.editor.getTrustedHTMLHandler();\n\n            switch (getPasteSource(event, this.convertSingleImageBody)) {\n                case KnownPasteSourceType.WordDesktop:\n                    // Handle HTML copied from Word\n                    convertPastedContentFromWord(event);\n                    break;\n                case KnownPasteSourceType.ExcelDesktop:\n                case KnownPasteSourceType.ExcelOnline:\n                    if (\n                        event.pasteType === PasteType.Normal ||\n                        event.pasteType === PasteType.MergeFormat\n                    ) {\n                        // Handle HTML copied from Excel\n                        convertPastedContentFromExcel(event, trustedHTMLHandler);\n                    }\n                    break;\n                case KnownPasteSourceType.PowerPointDesktop:\n                    convertPastedContentFromPowerPoint(event, trustedHTMLHandler);\n                    break;\n                case KnownPasteSourceType.WacComponents:\n                    convertPastedContentFromOfficeOnline(fragment, sanitizingOption);\n                    break;\n                case KnownPasteSourceType.GoogleSheets:\n                    sanitizingOption.additionalTagReplacements[GOOGLE_SHEET_NODE_NAME] = '*';\n                    break;\n                case KnownPasteSourceType.SingleImage:\n                    convertPasteContentForSingleImage(event, trustedHTMLHandler);\n                    break;\n                case KnownPasteSourceType.Default:\n                    convertPastedContentForLI(fragment);\n                    handleLineMerge(fragment);\n                    break;\n            }\n            sanitizeLinks(sanitizingOption);\n            sanitizeHtmlColorsFromPastedContent(sanitizingOption);\n            sanitizeBlockStyles(sanitizingOption);\n\n            // Replace unknown tags with SPAN\n            sanitizingOption.unknownTagReplacement = this.unknownTagReplacement;\n        }\n    }\n}\n\nfunction sanitizeBlockStyles(sanitizingOption: Required<HtmlSanitizerOptions>) {\n    chainSanitizerCallback(sanitizingOption.cssStyleCallbacks, 'display', (value: string) => {\n        return value != 'flex'; // return whether we keep the style\n    });\n}\n"]}