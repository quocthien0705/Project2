{"version":3,"file":"AutoFormat.js","sourceRoot":"","sources":["../../../../../packages/roosterjs-editor-plugins/lib/plugins/AutoFormat/AutoFormat.ts"],"names":[],"mappings":";;;IAGA,IAAM,iBAAiB,GAAG,wCAAwC,CAAC;IAEnE;;OAEG;IACH;QAAA;YACY,WAAM,GAAmB,IAAI,CAAC;YAC9B,iBAAY,GAAkB,IAAI,CAAC;QAgG/C,CAAC;QA9FG;;WAEG;QACH,4BAAO,GAAP;YACI,OAAO,YAAY,CAAC;QACxB,CAAC;QAED;;;WAGG;QACH,+BAAU,GAAV,UAAW,MAAe;YACtB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACzB,CAAC;QAED;;WAEG;QACH,4BAAO,GAAP;YACI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAC7B,CAAC;QAED;;;WAGG;QACH,kCAAa,GAAb,UAAc,KAAkB;YAAhC,iBAkEC;YAjEG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBACd,OAAO;aACV;YACD,IACI,KAAK,CAAC,SAAS,2BAAmC;gBAClD,KAAK,CAAC,SAAS,sBAA8B;gBAC7C,KAAK,CAAC,SAAS,oBAA4B,EAC7C;gBACE,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;aAC1B;YAED,IAAI,KAAK,CAAC,SAAS,qBAA6B,EAAE;gBAC9C,IAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC;gBAEpC,IAAI,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;oBACjC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;iBAC1B;gBAED,IACI,IAAI,CAAC,YAAY,KAAK,GAAG;oBACzB,CAAC,iBAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC;oBACjC,QAAQ,KAAK,GAAG,EAClB;oBACE,IAAM,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,KAAK,CAAC,CAAC;oBAC/D,IAAM,gBAAgB,GAAG,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,kBAAkB,CAAC,CAAC,CAAC,CAAC;oBACzD,IAAM,MAAM,GAAG,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,kBAAkB,CAAC,CAAC,CAAC,CAAC;oBAC/C,IAAM,iBAAiB,GAAG,CAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAG,CAAC,CAAC,MAAK,GAAG,CAAC;oBACxD,IAAM,QAAQ,GACV,CAAC,gBAAgB,IAAI,KAAK,IAAI,QAAQ,KAAK,GAAG,CAAC;wBAC/C,CAAC,gBAAgB,KAAK,KAAK,IAAI,QAAQ,KAAK,GAAG,CAAC,CAAC;oBAErD,IACI,iBAAiB;wBACjB,QAAQ;wBACR,CAAC,OAAO,gBAAgB,KAAK,QAAQ;4BACjC,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC;wBAChD,MAAM,KAAK,IAAI,EACjB;wBACE,OAAO;qBACV;oBAED,IAAM,WAAS,GAAG,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;oBAC5E,IAAM,YAAU,GACZ,gBAAgB,KAAK,KAAK,IAAI,QAAQ,KAAK,GAAG;wBAC1C,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC;wBAC9B,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;oBACvC,IAAI,CAAC,MAAM,CAAC,eAAe,CACvB;wBACI,IAAI,WAAS,EAAE;4BACX,WAAS,CAAC,cAAc,EAAE,CAAC;4BAC3B,WAAS,CAAC,UAAU,CAAC,YAAU,CAAC,CAAC;4BACjC,KAAI,CAAC,MAAO,CAAC,MAAM,CAAC,YAAU,eAAmB,CAAC;yBACrD;oBACL,CAAC,yBAED,IAAI,CAAC,sBAAsB,EAC3B,EAAE,aAAa,EAAE,YAAY,EAAE,CAClC,CAAC;oBAEF,+DAA+D;oBAC/D,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;iBAC5B;qBAAM;oBACH,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC;iBAChC;aACJ;QACL,CAAC;QACL,iBAAC;IAAD,CAAC,AAlGD,IAkGC","sourcesContent":["import { ChangeSource, PluginEventType, PositionType } from 'roosterjs-editor-types';\nimport type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-editor-types';\n\nconst specialCharacters = /[`!@#$%^&*()_+\\=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\n\n/**\n * Automatically transform -- into hyphen, if typed between two words.\n */\nexport default class AutoFormat implements EditorPlugin {\n    private editor: IEditor | null = null;\n    private lastKeyTyped: string | null = null;\n\n    /**\n     * Get a friendly name of this plugin\n     */\n    getName() {\n        return 'AutoFormat';\n    }\n\n    /**\n     * Initialize this plugin\n     * @param editor The editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor = null;\n        this.lastKeyTyped = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor) {\n            return;\n        }\n        if (\n            event.eventType === PluginEventType.ContentChanged ||\n            event.eventType === PluginEventType.MouseDown ||\n            event.eventType === PluginEventType.MouseUp\n        ) {\n            this.lastKeyTyped = '';\n        }\n\n        if (event.eventType === PluginEventType.KeyPress) {\n            const keyTyped = event.rawEvent.key;\n\n            if (keyTyped && keyTyped.length > 1) {\n                this.lastKeyTyped = '';\n            }\n\n            if (\n                this.lastKeyTyped === '-' &&\n                !specialCharacters.test(keyTyped) &&\n                keyTyped !== '-'\n            ) {\n                const searcher = this.editor.getContentSearcherOfCursor(event);\n                const textBeforeCursor = searcher?.getSubStringBefore(3);\n                const dashes = searcher?.getSubStringBefore(2);\n                const isPrecededByADash = textBeforeCursor?.[0] === '-';\n                const isSpaced =\n                    (textBeforeCursor == ' --' && keyTyped !== ' ') ||\n                    (textBeforeCursor !== ' --' && keyTyped === ' ');\n\n                if (\n                    isPrecededByADash ||\n                    isSpaced ||\n                    (typeof textBeforeCursor === 'string' &&\n                        specialCharacters.test(textBeforeCursor[0])) ||\n                    dashes !== '--'\n                ) {\n                    return;\n                }\n\n                const textRange = searcher?.getRangeFromText(dashes, true /* exactMatch */);\n                const nodeHyphen =\n                    textBeforeCursor === ' --' && keyTyped === ' '\n                        ? document.createTextNode('–')\n                        : document.createTextNode('—');\n                this.editor.addUndoSnapshot(\n                    () => {\n                        if (textRange) {\n                            textRange.deleteContents();\n                            textRange.insertNode(nodeHyphen);\n                            this.editor!.select(nodeHyphen, PositionType.End);\n                        }\n                    },\n                    ChangeSource.Format /*changeSource*/,\n                    true /*canUndoByBackspace*/,\n                    { formatApiName: 'autoHyphen' }\n                );\n\n                //After the substitution the last key typed needs to be cleaned\n                this.lastKeyTyped = null;\n            } else {\n                this.lastKeyTyped = keyTyped;\n            }\n        }\n    }\n}\n"]}