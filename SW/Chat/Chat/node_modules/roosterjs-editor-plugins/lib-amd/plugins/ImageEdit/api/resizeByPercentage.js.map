{"version":3,"file":"resizeByPercentage.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/ImageEdit/api/resizeByPercentage.ts"],"names":[],"mappings":";;;IAOA;;;;;;;;OAQG;IACH,SAAwB,kBAAkB,CACtC,MAAe,EACf,KAAuB,EACvB,UAAkB,EAClB,QAAgB,EAChB,SAAiB;QAEjB,IAAM,QAAQ,GAAG,IAAA,+BAAoB,EAAC,KAAK,CAAC,CAAC;QAE7C,IAAI,CAAC,IAAA,qBAAW,EAAC,KAAK,EAAE,UAAU,CAAC,EAAE;YACjC,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,EAAE;gBACxB,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,QAAQ,EAAE;oBAC5D,IAAM,SAAO,GAAG,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;oBACpC,IAAA,KAAoB,IAAA,mCAAyB,EAAC,QAAQ,EAAE,UAAU,CAAC,EAAjE,KAAK,WAAA,EAAE,MAAM,YAAoD,CAAC;oBAC1E,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;oBAC7C,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;oBAEhD,MAAM,CAAC,eAAe,CAAC;wBACnB,IAAA,qBAAW,EAAC,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,SAAO,IAAI,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;oBAC7E,CAAC,kCAA2B,CAAC;oBAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;iBACxB;YACL,CAAC,CAAC,CAAC;SACN;IACL,CAAC;IAxBD,qCAwBC;IAED,SAAS,SAAS,CAAC,GAAqB,EAAE,GAAW,EAAE,QAAoB;QACvE,GAAG,CAAC,MAAM,GAAG;YACT,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC;YAClB,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC;YACnB,QAAQ,EAAE,CAAC;QACf,CAAC,CAAC;QACF,GAAG,CAAC,OAAO,GAAG;YACV,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC;YAClB,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC;YACnB,QAAQ,EAAE,CAAC;QACf,CAAC,CAAC;QACF,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC;IAClB,CAAC","sourcesContent":["import applyChange from '../editInfoUtils/applyChange';\nimport getTargetSizeByPercentage from '../editInfoUtils/getTargetSizeByPercentage';\nimport isResizedTo from './isResizedTo';\nimport { ChangeSource } from 'roosterjs-editor-types';\nimport { getEditInfoFromImage } from '../editInfoUtils/editInfo';\nimport type { IEditor } from 'roosterjs-editor-types';\n\n/**\n * Resize the image by percentage of its natural size. If the image is cropped or rotated,\n * the final size will also calculated with crop and rotate info.\n * @param editor The editor that contains the image\n * @param image The image to resize\n * @param percentage Percentage to resize to\n * @param minWidth Minimum width\n * @param minHeight Minimum height\n */\nexport default function resizeByPercentage(\n    editor: IEditor,\n    image: HTMLImageElement,\n    percentage: number,\n    minWidth: number,\n    minHeight: number\n) {\n    const editInfo = getEditInfoFromImage(image);\n\n    if (!isResizedTo(image, percentage)) {\n        loadImage(image, image.src, () => {\n            if (!editor.isDisposed() && editor.contains(image) && editInfo) {\n                const lastSrc = image.getAttribute('src');\n                const { width, height } = getTargetSizeByPercentage(editInfo, percentage);\n                editInfo.widthPx = Math.max(width, minWidth);\n                editInfo.heightPx = Math.max(height, minHeight);\n\n                editor.addUndoSnapshot(() => {\n                    applyChange(editor, image, editInfo, lastSrc || '', true /*wasResized*/);\n                }, ChangeSource.ImageResize);\n                editor.select(image);\n            }\n        });\n    }\n}\n\nfunction loadImage(img: HTMLImageElement, src: string, callback: () => void) {\n    img.onload = () => {\n        img.onload = null;\n        img.onerror = null;\n        callback();\n    };\n    img.onerror = () => {\n        img.onload = null;\n        img.onerror = null;\n        callback();\n    };\n    img.src = src;\n}\n"]}