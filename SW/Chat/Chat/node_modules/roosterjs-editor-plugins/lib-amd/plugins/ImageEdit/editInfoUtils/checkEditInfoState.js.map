{"version":3,"file":"checkEditInfoState.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-editor-plugins/lib/plugins/ImageEdit/editInfoUtils/checkEditInfoState.ts"],"names":[],"mappings":";;;;IAGA,IAAM,WAAW,GAAyB,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;IAClE,IAAM,WAAW,GAAyB,CAAC,UAAU,CAAC,CAAC;IACvD,IAAM,SAAS,GAAuB;QAClC,aAAa;QACb,cAAc;QACd,YAAY;QACZ,eAAe;KAClB,CAAC;IACF,IAAM,gBAAgB,iFAA8C,WAAW,+BAAK,SAAS,SAAC,CAAC;IAC/F,IAAM,QAAQ,iFAAO,gBAAgB,+BAAK,WAAW,SAAC,CAAC;IAEvD;;;;OAIG;IACH,6CAA6C;IAC7C,IAAkB,kBA2BjB;IA3BD,WAAkB,kBAAkB;QAChC;;;WAGG;QACH,iEAAO,CAAA;QAEP;;;WAGG;QACH,uEAAU,CAAA;QAEV;;;;;WAKG;QACH,2EAAY,CAAA;QAEZ;;;;WAIG;QACH,2EAAY,CAAA;IAChB,CAAC,EA3BiB,kBAAkB,GAAlB,0BAAkB,KAAlB,0BAAkB,QA2BnC;IAED;;;;;;;;;OASG;IACH,SAAwB,kBAAkB,CACtC,QAAuB,EACvB,SAAyB;QAEzB,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,CAAC,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,UAAA,GAAG,IAAI,OAAA,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAxB,CAAwB,CAAC,EAAE;YAC9E,uBAAkC;SACrC;aAAM,IACH,gBAAgB,CAAC,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAA/B,CAA+B,CAAC;YAC9D,CAAC,QAAQ,CAAC,iBAAiB;YAC3B,CAAC,QAAQ,CAAC,eAAe;YACzB,CAAC,CAAC,SAAS,IAAI,CAAC,SAAS,IAAI,QAAQ,CAAC,QAAQ,KAAK,SAAS,CAAC,QAAQ,CAAC,CAAC,EACzE;YACE,0BAAqC;SACxC;aAAM,IACH,SAAS;YACT,WAAW,CAAC,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAA/B,CAA+B,CAAC;YACzD,WAAW,CAAC,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAAhC,CAAgC,CAAC;YAC1D,SAAS,CAAC,KAAK,CAAC,UAAA,GAAG,IAAI,OAAA,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,EAA5C,CAA4C,CAAC;YACpE,SAAS,CAAC,iBAAiB,KAAK,QAAQ,CAAC,iBAAiB;YAC1D,SAAS,CAAC,eAAe,KAAK,QAAQ,CAAC,eAAe,EACxD;YACE,4BAAuC;SAC1C;aAAM;YACH,4BAAuC;SAC1C;IACL,CAAC;IAzBD,qCAyBC;IAED,SAAS,QAAQ,CAAC,CAAM;QACpB,OAAO,OAAO,CAAC,KAAK,QAAQ,CAAC;IACjC,CAAC;IAED,SAAS,aAAa,CAAC,EAAU,EAAE,EAAU;QACzC,OAAO,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC;IACpC,CAAC","sourcesContent":["import type { CropInfo, ResizeInfo, RotateInfo } from '../types/ImageEditInfo';\nimport type ImageEditInfo from '../types/ImageEditInfo';\n\nconst RESIZE_KEYS: (keyof ResizeInfo)[] = ['widthPx', 'heightPx'];\nconst ROTATE_KEYS: (keyof RotateInfo)[] = ['angleRad'];\nconst CROP_KEYS: (keyof CropInfo)[] = [\n    'leftPercent',\n    'rightPercent',\n    'topPercent',\n    'bottomPercent',\n];\nconst ROTATE_CROP_KEYS: (keyof RotateInfo | keyof CropInfo)[] = [...ROTATE_KEYS, ...CROP_KEYS];\nconst ALL_KEYS = [...ROTATE_CROP_KEYS, ...RESIZE_KEYS];\n\n/**\n * @internal\n * State of an edit info object for image editing.\n * It is returned by checkEditInfoState() function\n */\n// eslint-disable-next-line etc/no-const-enum\nexport const enum ImageEditInfoState {\n    /**\n     * Invalid edit info. It means the given edit info object is either null,\n     * or not all its member are of correct type\n     */\n    Invalid,\n\n    /**\n     * The edit info shows that it is only potentially edited by resizing action.\n     * Image is not rotated or cropped, or event not changed at all.\n     */\n    ResizeOnly,\n\n    /**\n     * When compare with another edit info, this value can be returned when both current\n     * edit info and the other one are not been rotated, and they have same cropping\n     * percentages. So that they can share the same image src, only width and height\n     * need to be adjusted.\n     */\n    SameWithLast,\n\n    /**\n     * When this value is returned, it means the image is edited by either cropping or\n     * rotation, or both. Image source can't be reused, need to generate a new image src\n     * data uri.\n     */\n    FullyChanged,\n}\n\n/**\n * @internal\n * Check the state of an edit info\n * @param editInfo The edit info to check\n * @param compareTo An optional edit info to compare to\n * @returns If the source edit info is not valid (wrong type, missing field, ...), returns Invalid.\n * If the source edit info doesn't contain any rotation or cropping, returns ResizeOnly\n * If the compare edit info exists, and both of them don't contain rotation, and the have same cropping values,\n * returns SameWithLast. Otherwise, returns FullyChanged\n */\nexport default function checkEditInfoState(\n    editInfo: ImageEditInfo,\n    compareTo?: ImageEditInfo\n): ImageEditInfoState {\n    if (!editInfo || !editInfo.src || ALL_KEYS.some(key => !isNumber(editInfo[key]))) {\n        return ImageEditInfoState.Invalid;\n    } else if (\n        ROTATE_CROP_KEYS.every(key => areSameNumber(editInfo[key], 0)) &&\n        !editInfo.flippedHorizontal &&\n        !editInfo.flippedVertical &&\n        (!compareTo || (compareTo && editInfo.angleRad === compareTo.angleRad))\n    ) {\n        return ImageEditInfoState.ResizeOnly;\n    } else if (\n        compareTo &&\n        ROTATE_KEYS.every(key => areSameNumber(editInfo[key], 0)) &&\n        ROTATE_KEYS.every(key => areSameNumber(compareTo[key], 0)) &&\n        CROP_KEYS.every(key => areSameNumber(editInfo[key], compareTo[key])) &&\n        compareTo.flippedHorizontal === editInfo.flippedHorizontal &&\n        compareTo.flippedVertical === editInfo.flippedVertical\n    ) {\n        return ImageEditInfoState.SameWithLast;\n    } else {\n        return ImageEditInfoState.FullyChanged;\n    }\n}\n\nfunction isNumber(o: any): o is number {\n    return typeof o === 'number';\n}\n\nfunction areSameNumber(n1: number, n2: number) {\n    return Math.abs(n1 - n2) < 1e-3;\n}\n"]}