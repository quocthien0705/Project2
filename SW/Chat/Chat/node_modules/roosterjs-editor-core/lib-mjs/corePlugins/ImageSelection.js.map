{"version":3,"file":"ImageSelection.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-core/lib/corePlugins/ImageSelection.ts"],"names":[],"mappings":"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","sourcesContent":["import { PluginEventType, PositionType, SelectionRangeTypes } from 'roosterjs-editor-types';\nimport { safeInstanceOf } from 'roosterjs-editor-dom';\nimport type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-editor-types';\n\nconst Escape = 'Escape';\nconst Delete = 'Delete';\nconst mouseMiddleButton = 1;\n\n/**\n * @internal\n * Detect image selection and help highlight the image\n */\nexport default class ImageSelection implements EditorPlugin {\n    private editor: IEditor | null = null;\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'ImageSelection';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor?.select(null);\n        this.editor = null;\n    }\n\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor) {\n            switch (event.eventType) {\n                case PluginEventType.MouseUp:\n                    const target = event.rawEvent.target;\n                    if (\n                        safeInstanceOf(target, 'HTMLImageElement') &&\n                        target.isContentEditable &&\n                        event.rawEvent.button != mouseMiddleButton &&\n                        event.isClicking\n                    ) {\n                        this.editor.select(target);\n                    }\n                    break;\n                case PluginEventType.MouseDown:\n                    const mouseTarget = event.rawEvent.target;\n                    const mouseSelection = this.editor.getSelectionRangeEx();\n                    if (\n                        mouseSelection &&\n                        mouseSelection.type === SelectionRangeTypes.ImageSelection &&\n                        mouseSelection.image !== mouseTarget\n                    ) {\n                        this.editor.select(null);\n                    }\n                    break;\n                case PluginEventType.KeyDown:\n                    const rawEvent = event.rawEvent;\n                    const key = rawEvent.key;\n                    const keyDownSelection = this.editor.getSelectionRangeEx();\n                    if (\n                        !rawEvent.ctrlKey &&\n                        !rawEvent.altKey &&\n                        !rawEvent.shiftKey &&\n                        !rawEvent.metaKey &&\n                        keyDownSelection.type === SelectionRangeTypes.ImageSelection\n                    ) {\n                        const imageParent = keyDownSelection.image?.parentNode;\n                        if (key === Escape && imageParent) {\n                            this.editor.select(keyDownSelection.image, PositionType.Before);\n                            this.editor.getSelectionRange()?.collapse();\n                            event.rawEvent.stopPropagation();\n                        } else if (key === Delete) {\n                            this.editor.deleteNode(keyDownSelection.image);\n                            event.rawEvent.preventDefault();\n                        } else if (imageParent) {\n                            this.editor.select(keyDownSelection.image, PositionType.Before);\n                        }\n                    }\n                    break;\n                case PluginEventType.ContextMenu:\n                    const contextMenuTarget = event.rawEvent.target;\n                    const actualSelection = this.editor.getSelectionRangeEx();\n                    if (\n                        safeInstanceOf(contextMenuTarget, 'HTMLImageElement') &&\n                        (actualSelection.type !== SelectionRangeTypes.ImageSelection ||\n                            actualSelection.image !== contextMenuTarget)\n                    ) {\n                        this.editor.select(contextMenuTarget);\n                    }\n            }\n        }\n    }\n}\n"]}