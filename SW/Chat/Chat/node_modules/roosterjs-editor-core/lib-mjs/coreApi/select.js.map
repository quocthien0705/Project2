{"version":3,"file":"select.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-core/lib/coreApi/select.ts"],"names":[],"mappings":"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","sourcesContent":["import { contains, createRange, safeInstanceOf } from 'roosterjs-editor-dom';\nimport { PluginEventType, SelectionRangeTypes } from 'roosterjs-editor-types';\nimport type {\n    EditorCore,\n    NodePosition,\n    PositionType,\n    Select,\n    SelectionPath,\n    SelectionRangeEx,\n    TableSelection,\n} from 'roosterjs-editor-types';\n\n/**\n * @internal\n * Select content according to the given information.\n * There are a bunch of allowed combination of parameters. See IEditor.select for more details\n * @param core The editor core object\n * @param arg1 A DOM Range, or SelectionRangeEx, or NodePosition, or Node, or Selection Path\n * @param arg2 (optional) A NodePosition, or an offset number, or a PositionType, or a TableSelection\n * @param arg3 (optional) A Node\n * @param arg4 (optional) An offset number, or a PositionType\n */\nexport const select: Select = (core, arg1, arg2, arg3, arg4) => {\n    const rangeEx = buildRangeEx(core, arg1, arg2, arg3, arg4);\n\n    if (rangeEx) {\n        const skipReselectOnFocus = core.domEvent.skipReselectOnFocus;\n\n        // We are applying a new selection, so we don't need to apply cached selection in DOMEventPlugin.\n        // Set skipReselectOnFocus to skip this behavior\n        core.domEvent.skipReselectOnFocus = true;\n\n        try {\n            applyRangeEx(core, rangeEx);\n        } finally {\n            core.domEvent.skipReselectOnFocus = skipReselectOnFocus;\n        }\n    } else {\n        core.domEvent.tableSelectionRange = core.api.selectTable(core, null);\n        core.domEvent.imageSelectionRange = core.api.selectImage(core, null);\n    }\n\n    return !!rangeEx;\n};\n\nfunction buildRangeEx(\n    core: EditorCore,\n    arg1: Range | SelectionRangeEx | NodePosition | Node | SelectionPath | null,\n    arg2?: NodePosition | number | PositionType | TableSelection | null,\n    arg3?: Node,\n    arg4?: number | PositionType\n) {\n    let rangeEx: SelectionRangeEx | null = null;\n\n    if (isSelectionRangeEx(arg1)) {\n        rangeEx = arg1;\n    } else if (safeInstanceOf(arg1, 'HTMLTableElement') && isTableSelectionOrNull(arg2)) {\n        rangeEx = {\n            type: SelectionRangeTypes.TableSelection,\n            ranges: [],\n            areAllCollapsed: false,\n            table: arg1,\n            coordinates: arg2 ?? undefined,\n        };\n    } else if (safeInstanceOf(arg1, 'HTMLImageElement') && typeof arg2 == 'undefined') {\n        rangeEx = {\n            type: SelectionRangeTypes.ImageSelection,\n            ranges: [],\n            areAllCollapsed: false,\n            image: arg1,\n        };\n    } else {\n        const range = !arg1\n            ? null\n            : safeInstanceOf(arg1, 'Range')\n            ? arg1\n            : isSelectionPath(arg1)\n            ? createRange(core.contentDiv, arg1.start, arg1.end)\n            : isNodePosition(arg1) || safeInstanceOf(arg1, 'Node')\n            ? createRange(\n                  <Node>arg1,\n                  <number | PositionType>arg2,\n                  <Node>arg3,\n                  <number | PositionType>arg4\n              )\n            : null;\n\n        rangeEx = range\n            ? {\n                  type: SelectionRangeTypes.Normal,\n                  ranges: [range],\n                  areAllCollapsed: range.collapsed,\n              }\n            : null;\n    }\n\n    return rangeEx;\n}\n\nfunction applyRangeEx(core: EditorCore, rangeEx: SelectionRangeEx | null) {\n    switch (rangeEx?.type) {\n        case SelectionRangeTypes.TableSelection:\n            if (contains(core.contentDiv, rangeEx.table)) {\n                core.domEvent.imageSelectionRange = core.api.selectImage(core, null);\n                core.domEvent.tableSelectionRange = core.api.selectTable(\n                    core,\n                    rangeEx.table,\n                    rangeEx.coordinates\n                );\n                rangeEx = core.domEvent.tableSelectionRange;\n            }\n            break;\n        case SelectionRangeTypes.ImageSelection:\n            if (contains(core.contentDiv, rangeEx.image)) {\n                core.domEvent.tableSelectionRange = core.api.selectTable(core, null);\n                core.domEvent.imageSelectionRange = core.api.selectImage(core, rangeEx.image);\n                rangeEx = core.domEvent.imageSelectionRange;\n            }\n            break;\n        case SelectionRangeTypes.Normal:\n            core.domEvent.tableSelectionRange = core.api.selectTable(core, null);\n            core.domEvent.imageSelectionRange = core.api.selectImage(core, null);\n\n            if (contains(core.contentDiv, rangeEx.ranges[0])) {\n                core.api.selectRange(core, rangeEx.ranges[0]);\n            } else {\n                rangeEx = null;\n            }\n            break;\n    }\n\n    core.api.triggerEvent(\n        core,\n        {\n            eventType: PluginEventType.SelectionChanged,\n            selectionRangeEx: rangeEx,\n        },\n        true /** broadcast **/\n    );\n}\n\nfunction isSelectionRangeEx(obj: any): obj is SelectionRangeEx {\n    const rangeEx = obj as SelectionRangeEx;\n    return (\n        rangeEx &&\n        typeof rangeEx == 'object' &&\n        typeof rangeEx.type == 'number' &&\n        Array.isArray(rangeEx.ranges)\n    );\n}\n\nfunction isTableSelectionOrNull(obj: any): obj is TableSelection | null {\n    const selection = obj as TableSelection | null;\n\n    return (\n        selection === null ||\n        (selection &&\n            typeof selection == 'object' &&\n            typeof selection.firstCell == 'object' &&\n            typeof selection.lastCell == 'object')\n    );\n}\n\nfunction isSelectionPath(obj: any): obj is SelectionPath {\n    const path = obj as SelectionPath;\n\n    return path && typeof path == 'object' && Array.isArray(path.start) && Array.isArray(path.end);\n}\n\nfunction isNodePosition(obj: any): obj is NodePosition {\n    const pos = obj as NodePosition;\n\n    return (\n        pos &&\n        typeof pos == 'object' &&\n        typeof pos.node == 'object' &&\n        typeof pos.offset == 'number'\n    );\n}\n"]}