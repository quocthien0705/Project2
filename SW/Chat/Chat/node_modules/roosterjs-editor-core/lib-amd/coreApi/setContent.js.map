{"version":3,"file":"setContent.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-core/lib/coreApi/setContent.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    ChangeSource,\n    ColorTransformDirection,\n    PluginEventType,\n    SelectionRangeTypes,\n} from 'roosterjs-editor-types';\nimport {\n    createRange,\n    extractContentMetadata,\n    queryElements,\n    restoreContentWithEntityPlaceholder,\n} from 'roosterjs-editor-dom';\nimport type { ContentMetadata, EditorCore, SetContent } from 'roosterjs-editor-types';\n\n/**\n * @internal\n * Set HTML content to this editor. All existing content will be replaced. A ContentChanged event will be triggered\n * if triggerContentChangedEvent is set to true\n * @param core The EditorCore object\n * @param content HTML content to set in\n * @param triggerContentChangedEvent True to trigger a ContentChanged event. Default value is true\n * @param metadata @optional Metadata of the content that helps editor know the selection and color mode.\n * If not passed, we will treat content as in light mode without selection\n */\nexport const setContent: SetContent = (\n    core: EditorCore,\n    content: string,\n    triggerContentChangedEvent: boolean,\n    metadata?: ContentMetadata\n) => {\n    let contentChanged = false;\n    if (core.contentDiv.innerHTML != content) {\n        core.api.triggerEvent(\n            core,\n            {\n                eventType: PluginEventType.BeforeSetContent,\n                newContent: content,\n            },\n            true /*broadcast*/\n        );\n\n        const entities = core.entity.entityMap;\n        const html = content || '';\n        const body = new DOMParser().parseFromString(\n            core.trustedHTMLHandler?.(html) ?? html,\n            'text/html'\n        ).body;\n\n        restoreContentWithEntityPlaceholder(body, core.contentDiv, entities);\n\n        const metadataFromContent = extractContentMetadata(core.contentDiv);\n        metadata = metadata || metadataFromContent;\n        selectContentMetadata(core, metadata);\n        contentChanged = true;\n    }\n\n    const isDarkMode = core.lifecycle.isDarkMode;\n\n    if ((!metadata && isDarkMode) || (metadata && !!metadata.isDarkMode != !!isDarkMode)) {\n        core.api.transformColor(\n            core,\n            core.contentDiv,\n            false /*includeSelf*/,\n            null /*callback*/,\n            isDarkMode ? ColorTransformDirection.LightToDark : ColorTransformDirection.DarkToLight,\n            true /*forceTransform*/,\n            metadata?.isDarkMode\n        );\n        contentChanged = true;\n    }\n\n    if (triggerContentChangedEvent && contentChanged) {\n        core.api.triggerEvent(\n            core,\n            {\n                eventType: PluginEventType.ContentChanged,\n                source: ChangeSource.SetContent,\n            },\n            false /*broadcast*/\n        );\n    }\n};\n\nfunction selectContentMetadata(core: EditorCore, metadata: ContentMetadata | undefined) {\n    if (!core.lifecycle.shadowEditSelectionPath && metadata) {\n        core.domEvent.tableSelectionRange = null;\n        core.domEvent.imageSelectionRange = null;\n        core.domEvent.selectionRange = null;\n\n        switch (metadata.type) {\n            case SelectionRangeTypes.Normal:\n                core.api.selectTable(core, null);\n                core.api.selectImage(core, null);\n\n                const range = createRange(core.contentDiv, metadata.start, metadata.end);\n                core.api.selectRange(core, range);\n                break;\n            case SelectionRangeTypes.TableSelection:\n                const table = queryElements(\n                    core.contentDiv,\n                    '#' + metadata.tableId\n                )[0] as HTMLTableElement;\n\n                if (table) {\n                    core.domEvent.tableSelectionRange = core.api.selectTable(core, table, metadata);\n                }\n                break;\n            case SelectionRangeTypes.ImageSelection:\n                const image = queryElements(\n                    core.contentDiv,\n                    '#' + metadata.imageId\n                )[0] as HTMLImageElement;\n\n                if (image) {\n                    core.domEvent.imageSelectionRange = core.api.selectImage(core, image);\n                }\n                break;\n        }\n    }\n}\n"]}