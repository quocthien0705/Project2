{"version":3,"file":"selectRange.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-core/lib/coreApi/selectRange.ts"],"names":[],"mappings":";;;;IAWA;;;;;;;;OAQG;IACI,IAAM,WAAW,GAAgB,UACpC,IAAgB,EAChB,KAAY,EACZ,aAAuB;QAEvB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,uBAAuB,IAAI,IAAA,+BAAQ,EAAC,IAAI,CAAC,UAAU,EAAE,KAAK,CAAC,EAAE;YAC7E,IAAA,0CAAmB,EAAC,KAAK,EAAE,aAAa,CAAC,CAAC;YAE1C,IAAI,CAAC,IAAA,mBAAQ,EAAC,IAAI,CAAC,EAAE;gBACjB,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,KAAK,CAAC;aACxC;YAED,IAAI,KAAK,CAAC,SAAS,EAAE;gBACjB,mDAAmD;gBACnD,kDAAkD;gBAClD,yBAAyB,CAAC,IAAI,CAAC,CAAC;aACnC;YAED,OAAO,IAAI,CAAC;SACf;aAAM;YACH,OAAO,KAAK,CAAC;SAChB;IACL,CAAC,CAAC;IAtBW,QAAA,WAAW,eAsBtB;IAEF;;OAEG;IACH,SAAS,yBAAyB,CAAC,IAAgB;QAE3C,IAAA,UAAU,GAGV,IAAI,WAHM,EACV,kBAAkB,GAElB,IAAI,mBAFc,EACX,iBAAiB,GACxB,IAAI,sBADoB,CACnB;QAET,IAAI,kBAAkB,CAAC,mBAAmB,EAAE;YACxC,IAAM,UAAQ,GAAG,UAAU,CAAC,aAAa,CAAC;YAC1C,IAAM,aAAW,GAAG,IAAA,6CAAsB,EAAC,UAAQ,CAAC,CAAC;YACrD,IAAA,oCAAa,EAAC,+CAAwB,CAAC,CAAC,OAAO,CAAC,UAAA,GAAG;;gBAC/C,IAAI,CAAC,CAAC,CAAA,MAAA,kBAAkB,CAAC,mBAAmB,0CAAG,GAAG,CAAC,CAAA,IAAI,aAAW,CAAC,GAAG,CAAC,EAAE;oBACrE,UAAQ,CAAC,WAAW,CAChB,+CAAwB,CAAC,GAAG,CAAC,EAC7B,KAAK,CAAC,YAAY,EAClB,SAAS,CAAC,WAAW,CACxB,CAAC;iBACL;YACL,CAAC,CAAC,CAAC;YAEH,IAAM,KAAK,GAAG,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAChE,IAAM,QAAQ,GAAoB,KAAK,IAAI,+BAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACpE,IAAI,QAAQ,EAAE;gBACV,kBAAkB,CAAC,sBAAsB,GAAG,QAAQ,CAAC;aACxD;SACJ;IACL,CAAC","sourcesContent":["import { hasFocus } from './hasFocus';\nimport type { EditorCore, SelectRange } from 'roosterjs-editor-types';\nimport {\n    contains,\n    getPendableFormatState,\n    Position,\n    PendableFormatCommandMap,\n    addRangeToSelection,\n    getObjectKeys,\n} from 'roosterjs-editor-dom';\n\n/**\n * @internal\n * Change the editor selection to the given range\n * @param core The EditorCore object\n * @param range The range to select\n * @param skipSameRange When set to true, do nothing if the given range is the same with current selection\n * in editor, otherwise it will always remove current selection range and set to the given one.\n * This parameter is always treat as true in Edge to avoid some weird runtime exception.\n */\nexport const selectRange: SelectRange = (\n    core: EditorCore,\n    range: Range,\n    skipSameRange?: boolean\n) => {\n    if (!core.lifecycle.shadowEditSelectionPath && contains(core.contentDiv, range)) {\n        addRangeToSelection(range, skipSameRange);\n\n        if (!hasFocus(core)) {\n            core.domEvent.selectionRange = range;\n        }\n\n        if (range.collapsed) {\n            // If selected, and current selection is collapsed,\n            // need to restore pending format state if exists.\n            restorePendingFormatState(core);\n        }\n\n        return true;\n    } else {\n        return false;\n    }\n};\n\n/**\n * Restore cached pending format state (if exist) to current selection\n */\nfunction restorePendingFormatState(core: EditorCore) {\n    const {\n        contentDiv,\n        pendingFormatState,\n        api: { getSelectionRange },\n    } = core;\n\n    if (pendingFormatState.pendableFormatState) {\n        const document = contentDiv.ownerDocument;\n        const formatState = getPendableFormatState(document);\n        getObjectKeys(PendableFormatCommandMap).forEach(key => {\n            if (!!pendingFormatState.pendableFormatState?.[key] != formatState[key]) {\n                document.execCommand(\n                    PendableFormatCommandMap[key],\n                    false /* showUI */,\n                    undefined /* value */\n                );\n            }\n        });\n\n        const range = getSelectionRange(core, true /*tryGetFromCache*/);\n        const position: Position | null = range && Position.getStart(range);\n        if (position) {\n            pendingFormatState.pendableFormatPosition = position;\n        }\n    }\n}\n"]}