{"version":3,"file":"select.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-core/lib/coreApi/select.ts"],"names":[],"mappings":"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","sourcesContent":["import { contains, createRange, safeInstanceOf } from 'roosterjs-editor-dom';\nimport { PluginEventType, SelectionRangeTypes } from 'roosterjs-editor-types';\nimport type {\n    EditorCore,\n    NodePosition,\n    PositionType,\n    Select,\n    SelectionPath,\n    SelectionRangeEx,\n    TableSelection,\n} from 'roosterjs-editor-types';\n\n/**\n * @internal\n * Select content according to the given information.\n * There are a bunch of allowed combination of parameters. See IEditor.select for more details\n * @param core The editor core object\n * @param arg1 A DOM Range, or SelectionRangeEx, or NodePosition, or Node, or Selection Path\n * @param arg2 (optional) A NodePosition, or an offset number, or a PositionType, or a TableSelection\n * @param arg3 (optional) A Node\n * @param arg4 (optional) An offset number, or a PositionType\n */\nexport const select: Select = (core, arg1, arg2, arg3, arg4) => {\n    const rangeEx = buildRangeEx(core, arg1, arg2, arg3, arg4);\n\n    if (rangeEx) {\n        const skipReselectOnFocus = core.domEvent.skipReselectOnFocus;\n\n        // We are applying a new selection, so we don't need to apply cached selection in DOMEventPlugin.\n        // Set skipReselectOnFocus to skip this behavior\n        core.domEvent.skipReselectOnFocus = true;\n\n        try {\n            applyRangeEx(core, rangeEx);\n        } finally {\n            core.domEvent.skipReselectOnFocus = skipReselectOnFocus;\n        }\n    } else {\n        core.domEvent.tableSelectionRange = core.api.selectTable(core, null);\n        core.domEvent.imageSelectionRange = core.api.selectImage(core, null);\n    }\n\n    return !!rangeEx;\n};\n\nfunction buildRangeEx(\n    core: EditorCore,\n    arg1: Range | SelectionRangeEx | NodePosition | Node | SelectionPath | null,\n    arg2?: NodePosition | number | PositionType | TableSelection | null,\n    arg3?: Node,\n    arg4?: number | PositionType\n) {\n    let rangeEx: SelectionRangeEx | null = null;\n\n    if (isSelectionRangeEx(arg1)) {\n        rangeEx = arg1;\n    } else if (safeInstanceOf(arg1, 'HTMLTableElement') && isTableSelectionOrNull(arg2)) {\n        rangeEx = {\n            type: SelectionRangeTypes.TableSelection,\n            ranges: [],\n            areAllCollapsed: false,\n            table: arg1,\n            coordinates: arg2 ?? undefined,\n        };\n    } else if (safeInstanceOf(arg1, 'HTMLImageElement') && typeof arg2 == 'undefined') {\n        rangeEx = {\n            type: SelectionRangeTypes.ImageSelection,\n            ranges: [],\n            areAllCollapsed: false,\n            image: arg1,\n        };\n    } else {\n        const range = !arg1\n            ? null\n            : safeInstanceOf(arg1, 'Range')\n            ? arg1\n            : isSelectionPath(arg1)\n            ? createRange(core.contentDiv, arg1.start, arg1.end)\n            : isNodePosition(arg1) || safeInstanceOf(arg1, 'Node')\n            ? createRange(\n                  <Node>arg1,\n                  <number | PositionType>arg2,\n                  <Node>arg3,\n                  <number | PositionType>arg4\n              )\n            : null;\n\n        rangeEx = range\n            ? {\n                  type: SelectionRangeTypes.Normal,\n                  ranges: [range],\n                  areAllCollapsed: range.collapsed,\n              }\n            : null;\n    }\n\n    return rangeEx;\n}\n\nfunction applyRangeEx(core: EditorCore, rangeEx: SelectionRangeEx | null) {\n    switch (rangeEx?.type) {\n        case SelectionRangeTypes.TableSelection:\n            if (contains(core.contentDiv, rangeEx.table)) {\n                core.domEvent.imageSelectionRange = core.api.selectImage(core, null);\n                core.domEvent.tableSelectionRange = core.api.selectTable(\n                    core,\n                    rangeEx.table,\n                    rangeEx.coordinates\n                );\n                rangeEx = core.domEvent.tableSelectionRange;\n            }\n            break;\n        case SelectionRangeTypes.ImageSelection:\n            if (contains(core.contentDiv, rangeEx.image)) {\n                core.domEvent.tableSelectionRange = core.api.selectTable(core, null);\n                core.domEvent.imageSelectionRange = core.api.selectImage(core, rangeEx.image);\n                rangeEx = core.domEvent.imageSelectionRange;\n            }\n            break;\n        case SelectionRangeTypes.Normal:\n            core.domEvent.tableSelectionRange = core.api.selectTable(core, null);\n            core.domEvent.imageSelectionRange = core.api.selectImage(core, null);\n\n            if (contains(core.contentDiv, rangeEx.ranges[0])) {\n                core.api.selectRange(core, rangeEx.ranges[0]);\n            } else {\n                rangeEx = null;\n            }\n            break;\n    }\n\n    core.api.triggerEvent(\n        core,\n        {\n            eventType: PluginEventType.SelectionChanged,\n            selectionRangeEx: rangeEx,\n        },\n        true /** broadcast **/\n    );\n}\n\nfunction isSelectionRangeEx(obj: any): obj is SelectionRangeEx {\n    const rangeEx = obj as SelectionRangeEx;\n    return (\n        rangeEx &&\n        typeof rangeEx == 'object' &&\n        typeof rangeEx.type == 'number' &&\n        Array.isArray(rangeEx.ranges)\n    );\n}\n\nfunction isTableSelectionOrNull(obj: any): obj is TableSelection | null {\n    const selection = obj as TableSelection | null;\n\n    return (\n        selection === null ||\n        (selection &&\n            typeof selection == 'object' &&\n            typeof selection.firstCell == 'object' &&\n            typeof selection.lastCell == 'object')\n    );\n}\n\nfunction isSelectionPath(obj: any): obj is SelectionPath {\n    const path = obj as SelectionPath;\n\n    return path && typeof path == 'object' && Array.isArray(path.start) && Array.isArray(path.end);\n}\n\nfunction isNodePosition(obj: any): obj is NodePosition {\n    const pos = obj as NodePosition;\n\n    return (\n        pos &&\n        typeof pos == 'object' &&\n        typeof pos.node == 'object' &&\n        typeof pos.offset == 'number'\n    );\n}\n"]}