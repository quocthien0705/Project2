{"version":3,"file":"ImageSelection.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-core/lib/corePlugins/ImageSelection.ts"],"names":[],"mappings":"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","sourcesContent":["import { PluginEventType, PositionType, SelectionRangeTypes } from 'roosterjs-editor-types';\nimport { safeInstanceOf } from 'roosterjs-editor-dom';\nimport type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-editor-types';\n\nconst Escape = 'Escape';\nconst Delete = 'Delete';\nconst mouseMiddleButton = 1;\n\n/**\n * @internal\n * Detect image selection and help highlight the image\n */\nexport default class ImageSelection implements EditorPlugin {\n    private editor: IEditor | null = null;\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'ImageSelection';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor?.select(null);\n        this.editor = null;\n    }\n\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor) {\n            switch (event.eventType) {\n                case PluginEventType.MouseUp:\n                    const target = event.rawEvent.target;\n                    if (\n                        safeInstanceOf(target, 'HTMLImageElement') &&\n                        target.isContentEditable &&\n                        event.rawEvent.button != mouseMiddleButton &&\n                        event.isClicking\n                    ) {\n                        this.editor.select(target);\n                    }\n                    break;\n                case PluginEventType.MouseDown:\n                    const mouseTarget = event.rawEvent.target;\n                    const mouseSelection = this.editor.getSelectionRangeEx();\n                    if (\n                        mouseSelection &&\n                        mouseSelection.type === SelectionRangeTypes.ImageSelection &&\n                        mouseSelection.image !== mouseTarget\n                    ) {\n                        this.editor.select(null);\n                    }\n                    break;\n                case PluginEventType.KeyDown:\n                    const rawEvent = event.rawEvent;\n                    const key = rawEvent.key;\n                    const keyDownSelection = this.editor.getSelectionRangeEx();\n                    if (\n                        !rawEvent.ctrlKey &&\n                        !rawEvent.altKey &&\n                        !rawEvent.shiftKey &&\n                        !rawEvent.metaKey &&\n                        keyDownSelection.type === SelectionRangeTypes.ImageSelection\n                    ) {\n                        const imageParent = keyDownSelection.image?.parentNode;\n                        if (key === Escape && imageParent) {\n                            this.editor.select(keyDownSelection.image, PositionType.Before);\n                            this.editor.getSelectionRange()?.collapse();\n                            event.rawEvent.stopPropagation();\n                        } else if (key === Delete) {\n                            this.editor.deleteNode(keyDownSelection.image);\n                            event.rawEvent.preventDefault();\n                        } else if (imageParent) {\n                            this.editor.select(keyDownSelection.image, PositionType.Before);\n                        }\n                    }\n                    break;\n                case PluginEventType.ContextMenu:\n                    const contextMenuTarget = event.rawEvent.target;\n                    const actualSelection = this.editor.getSelectionRangeEx();\n                    if (\n                        safeInstanceOf(contextMenuTarget, 'HTMLImageElement') &&\n                        (actualSelection.type !== SelectionRangeTypes.ImageSelection ||\n                            actualSelection.image !== contextMenuTarget)\n                    ) {\n                        this.editor.select(contextMenuTarget);\n                    }\n            }\n        }\n    }\n}\n"]}