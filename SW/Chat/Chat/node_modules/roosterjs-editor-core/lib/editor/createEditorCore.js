"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createEditorCore = void 0;
var tslib_1 = require("tslib");
var createCorePlugins_1 = require("../corePlugins/createCorePlugins");
var DarkColorHandlerImpl_1 = require("./DarkColorHandlerImpl");
var roosterjs_editor_dom_1 = require("roosterjs-editor-dom");
var coreApiMap_1 = require("../coreApi/coreApiMap");
/**
 * Create a new instance of Editor Core
 * @param contentDiv The DIV HTML element which will be the container element of editor
 * @param options An optional options object to customize the editor
 */
var createEditorCore = function (contentDiv, options) {
    var _a;
    var corePlugins = (0, createCorePlugins_1.default)(contentDiv, options);
    var plugins = [];
    (0, roosterjs_editor_dom_1.getObjectKeys)(corePlugins).forEach(function (name) {
        if (name == '_placeholder') {
            if (options.plugins) {
                (0, roosterjs_editor_dom_1.arrayPush)(plugins, options.plugins);
            }
        }
        else {
            plugins.push(corePlugins[name]);
        }
    });
    var pluginState = (0, createCorePlugins_1.getPluginState)(corePlugins);
    var zoomScale = ((_a = options.zoomScale) !== null && _a !== void 0 ? _a : -1) > 0 ? options.zoomScale : 1;
    var getVisibleViewport = options.getVisibleViewport ||
        (function () {
            var scrollContainer = pluginState.domEvent.scrollContainer;
            return (0, roosterjs_editor_dom_1.getIntersectedRect)(scrollContainer == core.contentDiv
                ? [scrollContainer]
                : [scrollContainer, core.contentDiv]);
        });
    var core = (0, tslib_1.__assign)((0, tslib_1.__assign)({ contentDiv: contentDiv, api: (0, tslib_1.__assign)((0, tslib_1.__assign)({}, coreApiMap_1.coreApiMap), (options.coreApiOverride || {})), originalApi: coreApiMap_1.coreApiMap, plugins: plugins.filter(function (x) { return !!x; }) }, pluginState), { trustedHTMLHandler: options.trustedHTMLHandler || (function (html) { return html; }), zoomScale: zoomScale, sizeTransformer: options.sizeTransformer || (function (size) { return size / zoomScale; }), getVisibleViewport: getVisibleViewport, imageSelectionBorderColor: options.imageSelectionBorderColor, darkColorHandler: new DarkColorHandlerImpl_1.default(contentDiv, pluginState.lifecycle.getDarkColor), disposeErrorHandler: options.disposeErrorHandler });
    return core;
};
exports.createEditorCore = createEditorCore;
//# sourceMappingURL=createEditorCore.js.map