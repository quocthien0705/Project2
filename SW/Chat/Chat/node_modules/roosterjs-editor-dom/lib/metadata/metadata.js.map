{"version":3,"file":"metadata.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-dom/lib/metadata/metadata.ts"],"names":[],"mappings":";;;AAAA,uCAAkC;AAGlC,IAAM,mBAAmB,GAAG,aAAa,CAAC;AAE1C;;;;;;;;GAQG;AACH,SAAgB,WAAW,CACvB,OAAoB,EACpB,UAA0B,EAC1B,YAAgB;IAEhB,IAAM,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;IACjD,IAAI,GAAQ,CAAC;IAEb,IAAI;QACA,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;KACtC;IAAC,WAAM,GAAE;IAEV,IAAI,OAAO,GAAG,KAAK,WAAW,EAAE;QAC5B,IAAI,CAAC,UAAU,EAAE;YACb,OAAO,GAAQ,CAAC;SACnB;aAAM,IAAI,IAAA,kBAAQ,EAAC,GAAG,EAAE,UAAU,CAAC,EAAE;YAClC,OAAO,GAAG,CAAC;SACd;KACJ;IAED,IAAI,YAAY,EAAE;QACd,OAAO,YAAY,CAAC;KACvB;SAAM;QACH,OAAO,IAAI,CAAC;KACf;AACL,CAAC;AAzBD,kCAyBC;AAED;;;;;;;GAOG;AACH,SAAgB,WAAW,CAAI,OAAoB,EAAE,QAAW,EAAE,GAAmB;IACjF,IAAI,CAAC,GAAG,IAAI,IAAA,kBAAQ,EAAC,QAAQ,EAAE,GAAG,CAAC,EAAE;QACjC,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAChE,OAAO,IAAI,CAAC;KACf;SAAM;QACH,OAAO,KAAK,CAAC;KAChB;AACL,CAAC;AAPD,kCAOC;AAED;;;;GAIG;AACH,SAAgB,cAAc,CAAI,OAAoB,EAAE,WAAoB;IACxE,IAAI,WAAW,EAAE;QACb,IAAM,eAAe,GAAQ,WAAW,CAAI,OAAO,CAAC,CAAC;QACrD,IAAI,eAAe,EAAE;YACjB,OAAO,eAAe,CAAC,WAAW,CAAC,CAAC;YACpC,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;SAC1E;KACJ;SAAM;QACH,OAAO,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;KAC/C;AACL,CAAC;AAVD,wCAUC","sourcesContent":["import validate from './validate';\nimport type { Definition } from 'roosterjs-editor-types';\n\nconst MetadataDataSetName = 'editingInfo';\n\n/**\n * Get metadata object from an HTML element\n * @param element The HTML element to get metadata object from\n * @param definition The type definition of this metadata used for validate this metadata object.\n * If not specified, no validation will be performed and always return whatever we get from the element\n * @param defaultValue The default value to return if the retrieved object cannot pass the validation,\n * or there is no metadata object at all\n * @returns The strong-type metadata object if it can be validated, or null\n */\nexport function getMetadata<T>(\n    element: HTMLElement,\n    definition?: Definition<T>,\n    defaultValue?: T\n): T | null {\n    const str = element.dataset[MetadataDataSetName];\n    let obj: any;\n\n    try {\n        obj = str ? JSON.parse(str) : null;\n    } catch {}\n\n    if (typeof obj !== 'undefined') {\n        if (!definition) {\n            return obj as T;\n        } else if (validate(obj, definition)) {\n            return obj;\n        }\n    }\n\n    if (defaultValue) {\n        return defaultValue;\n    } else {\n        return null;\n    }\n}\n\n/**\n * Set metadata object into an HTML element\n * @param element The HTML element to set metadata object to\n * @param metadata The metadata object to set\n * @param def An optional type definition object used for validate this metadata object.\n * If not specified, metadata will be set without validation\n * @returns True if metadata is set, otherwise false\n */\nexport function setMetadata<T>(element: HTMLElement, metadata: T, def?: Definition<T>): boolean {\n    if (!def || validate(metadata, def)) {\n        element.dataset[MetadataDataSetName] = JSON.stringify(metadata);\n        return true;\n    } else {\n        return false;\n    }\n}\n\n/**\n * Remove metadata from the given element if any\n * @param element The element to remove metadata from\n * @param metadataKey The metadata key to remove, if none provided it will delete all metadata\n */\nexport function removeMetadata<T>(element: HTMLElement, metadataKey?: string) {\n    if (metadataKey) {\n        const currentMetadata: any = getMetadata<T>(element);\n        if (currentMetadata) {\n            delete currentMetadata[metadataKey];\n            element.dataset[MetadataDataSetName] = JSON.stringify(currentMetadata);\n        }\n    } else {\n        delete element.dataset[MetadataDataSetName];\n    }\n}\n"]}