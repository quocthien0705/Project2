{"version":3,"file":"VTable.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-dom/lib/table/VTable.ts"],"names":[],"mappings":"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","sourcesContent":["import applyTableFormat from './applyTableFormat';\r\nimport getTagOfNode from '../utils/getTagOfNode';\r\nimport moveChildNodes from '../utils/moveChildNodes';\r\nimport normalizeRect from '../utils/normalizeRect';\r\nimport safeInstanceOf from '../utils/safeInstanceOf';\r\nimport toArray from '../jsUtils/toArray';\r\nimport { getTableCellMetadata, saveTableCellMetadata } from './tableCellInfo';\r\nimport { getTableFormatInfo, saveTableInfo } from './tableFormatInfo';\r\nimport { removeMetadata } from '../metadata/metadata';\r\nimport { TableBorderFormat, TableOperation } from 'roosterjs-editor-types';\r\nimport type {\r\n    SizeTransformer,\r\n    TableFormat,\r\n    TableSelection,\r\n    VCell,\r\n    DarkColorHandler,\r\n} from 'roosterjs-editor-types';\r\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\r\n\r\nconst DEFAULT_FORMAT: Required<TableFormat> = {\r\n    topBorderColor: '#ABABAB',\r\n    bottomBorderColor: '#ABABAB',\r\n    verticalBorderColor: '#ABABAB',\r\n    hasHeaderRow: false,\r\n    hasFirstColumn: false,\r\n    hasBandedRows: false,\r\n    hasBandedColumns: false,\r\n    bgColorEven: null,\r\n    bgColorOdd: '#ABABAB20',\r\n    headerRowColor: '#ABABAB',\r\n    tableBorderFormat: TableBorderFormat.DEFAULT,\r\n    keepCellShade: false,\r\n    verticalAlign: null,\r\n};\r\n\r\n/**\r\n * A virtual table class, represent an HTML table, by expand all merged cells to each separated cells\r\n */\r\nexport default class VTable {\r\n    /**\r\n     * The HTML table object\r\n     */\r\n    table: HTMLTableElement;\r\n\r\n    /**\r\n     * Virtual cells\r\n     */\r\n    cells: VCell[][] | null = null;\r\n\r\n    /**\r\n     * Current row index\r\n     */\r\n    row: number | undefined;\r\n\r\n    /**\r\n     * Current column index\r\n     */\r\n    col: number | undefined;\r\n\r\n    /**\r\n     * Current format of the table\r\n     */\r\n    formatInfo: Required<TableFormat> | null = null;\r\n\r\n    private trs: HTMLTableRowElement[] = [];\r\n\r\n    private tableSelection: TableSelection | null = null;\r\n\r\n    /**\r\n     * Create a new instance of VTable object using HTML TABLE or TD node\r\n     * @param node The HTML Table or TD node\r\n     * @param normalizeSize Whether table size needs to be normalized\r\n     * @param zoomScale When the table is under a zoomed container, pass in the zoom scale here\r\n     */\r\n    constructor(\r\n        node: HTMLTableElement | HTMLTableCellElement,\r\n        normalizeSize?: boolean,\r\n        zoomScale?: number | SizeTransformer\r\n    ) {\r\n        this.table = safeInstanceOf(node, 'HTMLTableElement') ? node : getTableFromTd(node);\r\n        if (this.table) {\r\n            const currentTd = safeInstanceOf(node, 'HTMLTableElement') ? null : node;\r\n            const trs = toArray(this.table.rows);\r\n            this.cells = trs.map(row => []);\r\n            trs.forEach((tr, rowIndex) => {\r\n                this.trs[rowIndex % 2] = tr;\r\n                for (let sourceCol = 0, targetCol = 0; sourceCol < tr.cells.length; sourceCol++) {\r\n                    // Skip the cells which already initialized\r\n                    for (; this.cells![rowIndex][targetCol]; targetCol++) {}\r\n                    const td = tr.cells[sourceCol];\r\n\r\n                    if (td == currentTd) {\r\n                        this.col = targetCol;\r\n                        this.row = rowIndex;\r\n                    }\r\n\r\n                    for (let colSpan = 0; colSpan < td.colSpan; colSpan++, targetCol++) {\r\n                        for (let rowSpan = 0; rowSpan < td.rowSpan; rowSpan++) {\r\n                            const hasTd: boolean = colSpan + rowSpan == 0;\r\n                            const rect = td.getBoundingClientRect();\r\n                            if (this.cells?.[rowIndex + rowSpan]) {\r\n                                this.cells[rowIndex + rowSpan][targetCol] = {\r\n                                    td: hasTd ? td : null,\r\n                                    spanLeft: colSpan > 0,\r\n                                    spanAbove: rowSpan > 0,\r\n                                    width: hasTd ? rect.width : undefined,\r\n                                    height: hasTd ? rect.height : undefined,\r\n                                };\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                for (let col = 0; col < this.cells![rowIndex].length; col++) {\r\n                    if (!this.cells![rowIndex][col]) {\r\n                        this.cells![rowIndex][col] = {\r\n                            td: null,\r\n                            spanLeft: false,\r\n                            spanAbove: false,\r\n                            width: undefined,\r\n                            height: undefined,\r\n                        };\r\n                    }\r\n                }\r\n            });\r\n            this.formatInfo = getTableFormatInfo(this.table);\r\n            if (normalizeSize) {\r\n                this.normalizeSize(typeof zoomScale == 'number' ? n => n / zoomScale : zoomScale);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Selected range of cells with the coordinates of the first and last cell selected.\r\n     */\r\n    public get selection(): TableSelection | null {\r\n        return this.tableSelection || null;\r\n    }\r\n\r\n    public set selection(value: TableSelection | null) {\r\n        if (value) {\r\n            const { firstCell } = value;\r\n            this.row = firstCell?.y;\r\n            this.col = firstCell?.x;\r\n        }\r\n        this.tableSelection = value;\r\n    }\r\n\r\n    /**\r\n     * Write the virtual table back to DOM tree to represent the change of VTable\r\n     * @param skipApplyFormat Do not reapply table format when write back. Only use this parameter when you are pretty sure there is no format or table structure change during the process.\r\n     * @param darkColorHandler An object to handle dark background colors, if not passed the cell background color will not be set\r\n     */\r\n    writeBack(skipApplyFormat?: boolean, darkColorHandler?: DarkColorHandler | null) {\r\n        if (this.cells) {\r\n            moveChildNodes(this.table);\r\n            this.cells.forEach((row, r) => {\r\n                const tr = cloneNode(this.trs[r % 2] || this.trs[0]);\r\n\r\n                if (tr) {\r\n                    this.table.appendChild(tr);\r\n                    row.forEach((cell, c) => {\r\n                        if (cell.td) {\r\n                            this.recalculateSpans(r, c);\r\n                            this.recalculateCellHeight(cell.td);\r\n                            tr!.appendChild(cell.td);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            if (this.formatInfo && !skipApplyFormat) {\r\n                saveTableInfo(this.table, this.formatInfo);\r\n                applyTableFormat(this.table, this.cells, this.formatInfo, darkColorHandler);\r\n            }\r\n        } else if (this.table) {\r\n            this.table.parentNode?.removeChild(this.table);\r\n        }\r\n    }\r\n\r\n    private recalculateCellHeight(td: HTMLTableCellElement) {\r\n        if (this.isEmptyCell(td) && td.rowSpan > 1) {\r\n            for (let i = 1; i < td.rowSpan; i++) {\r\n                const br = document.createElement('br');\r\n                td.appendChild(br);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply the given table format to this virtual table\r\n     * @param format Table format to apply\r\n     */\r\n    applyFormat(format: Partial<TableFormat>) {\r\n        if (!this.table) {\r\n            return;\r\n        }\r\n        this.formatInfo = {\r\n            ...DEFAULT_FORMAT,\r\n            ...(this.formatInfo || {}),\r\n            ...(format || {}),\r\n        };\r\n        if (!this.formatInfo.keepCellShade) {\r\n            this.deleteCellShadeDataset(this.cells);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove the cellShade dataset to apply a new style format at the cell.\r\n     * @param cells\r\n     */\r\n    private deleteCellShadeDataset(cells: VCell[][] | null) {\r\n        cells?.forEach(row => {\r\n            row.forEach(cell => {\r\n                if (cell.td) {\r\n                    removeMetadata(cell.td, 'bgColorOverride');\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Edit table with given operation.\r\n     * @param operation Table operation\r\n     */\r\n    edit(operation: TableOperation | CompatibleTableOperation) {\r\n        if (!this.table || !this.cells || this.row === undefined || this.col == undefined) {\r\n            return;\r\n        }\r\n\r\n        const currentRow = this.cells[this.row];\r\n        const currentCell = currentRow[this.col];\r\n        const firstRow = this.selection ? this.selection.firstCell.y : this.row;\r\n        const lastRow = this.selection ? this.selection.lastCell.y : this.row;\r\n        const firstColumn = this.selection ? this.selection.firstCell.x : this.col;\r\n        const lastColumn = this.selection ? this.selection.lastCell.x : this.col;\r\n        switch (operation) {\r\n            case TableOperation.InsertAbove:\r\n                for (let i = firstRow; i <= lastRow; i++) {\r\n                    this.cells.splice(firstRow, 0, currentRow.map(cloneCell));\r\n                }\r\n                break;\r\n            case TableOperation.InsertBelow:\r\n                for (let i = firstRow; i <= lastRow; i++) {\r\n                    const newRow = lastRow + this.countSpanAbove(lastRow, this.col);\r\n                    this.cells.splice(\r\n                        newRow,\r\n                        0,\r\n                        this.cells[newRow - 1].map((cell, colIndex) => {\r\n                            const nextCell = this.getCell(newRow, colIndex);\r\n\r\n                            if (nextCell.spanAbove) {\r\n                                return cloneCell(nextCell);\r\n                            } else if (cell.spanLeft) {\r\n                                const newCell = cloneCell(cell);\r\n                                newCell.spanAbove = false;\r\n                                return newCell;\r\n                            } else {\r\n                                return {\r\n                                    td: cloneNode(this.getTd(this.row!, colIndex)),\r\n                                };\r\n                            }\r\n                        })\r\n                    );\r\n                }\r\n\r\n                break;\r\n\r\n            case TableOperation.InsertLeft:\r\n                for (let i = firstColumn; i <= lastColumn; i++) {\r\n                    this.forEachCellOfCurrentColumn((cell, row) => {\r\n                        row.splice(i, 0, cloneCell(cell));\r\n                    });\r\n                }\r\n\r\n                break;\r\n            case TableOperation.InsertRight:\r\n                for (let i = firstColumn; i <= lastColumn; i++) {\r\n                    const newCol = lastColumn + this.countSpanLeft(this.row, lastColumn);\r\n                    this.forEachCellOfColumn(newCol - 1, (cell, row, i) => {\r\n                        const nextCell = this.getCell(i, newCol);\r\n                        let newCell: VCell;\r\n                        if (nextCell.spanLeft) {\r\n                            newCell = cloneCell(nextCell);\r\n                        } else if (cell.spanAbove) {\r\n                            newCell = cloneCell(cell);\r\n                            newCell.spanLeft = false;\r\n                        } else {\r\n                            newCell = {\r\n                                td: cloneNode(this.getTd(i, this.col!)),\r\n                            };\r\n                        }\r\n\r\n                        row.splice(newCol, 0, newCell);\r\n                    });\r\n                }\r\n\r\n                break;\r\n\r\n            case TableOperation.DeleteRow:\r\n                for (let rowIndex = firstRow; rowIndex <= lastRow; rowIndex++) {\r\n                    this.forEachCellOfRow(rowIndex, (cell: VCell, i: number) => {\r\n                        const nextCell = this.getCell(rowIndex + 1, i);\r\n                        if (cell.td && cell.td.rowSpan > 1 && nextCell.spanAbove) {\r\n                            nextCell.td = cell.td;\r\n                        }\r\n                    });\r\n                }\r\n                const removedRows = this.selection\r\n                    ? this.selection.lastCell.y - this.selection.firstCell.y\r\n                    : 0;\r\n                this.cells.splice(firstRow, removedRows + 1);\r\n                if (this.cells.length === 0) {\r\n                    this.cells = null;\r\n                }\r\n\r\n                break;\r\n            case TableOperation.DeleteColumn:\r\n                let deletedColumns = 0;\r\n                for (let colIndex = firstColumn; colIndex <= lastColumn; colIndex++) {\r\n                    this.forEachCellOfColumn(colIndex, (cell, row, i) => {\r\n                        const nextCell = this.getCell(i, colIndex + 1);\r\n                        if (cell.td && cell.td.colSpan > 1 && nextCell.spanLeft) {\r\n                            nextCell.td = cell.td;\r\n                        }\r\n                        const removedColumns = this.selection\r\n                            ? colIndex - deletedColumns\r\n                            : this.col!;\r\n                        row.splice(removedColumns, 1);\r\n                    });\r\n                    deletedColumns++;\r\n                }\r\n                if (this.cells?.length === 0 || this.cells?.every(row => row.length === 0)) {\r\n                    this.cells = null;\r\n                }\r\n                break;\r\n\r\n            case TableOperation.MergeAbove:\r\n            case TableOperation.MergeBelow:\r\n                const rowStep = operation == TableOperation.MergeAbove ? -1 : 1;\r\n                for (\r\n                    let rowIndex = this.row + rowStep;\r\n                    rowIndex >= 0 && rowIndex < this.cells.length;\r\n                    rowIndex += rowStep\r\n                ) {\r\n                    const cell = this.getCell(rowIndex, this.col);\r\n                    if (cell.td && !cell.spanAbove) {\r\n                        const aboveCell = rowIndex < this.row ? cell : currentCell;\r\n                        const belowCell = rowIndex < this.row ? currentCell : cell;\r\n                        this.mergeCells(aboveCell, belowCell);\r\n                        break;\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case TableOperation.MergeLeft:\r\n            case TableOperation.MergeRight:\r\n                const colStep = operation == TableOperation.MergeLeft ? -1 : 1;\r\n                for (\r\n                    let colIndex = this.col + colStep;\r\n                    colIndex >= 0 && colIndex < this.cells[this.row].length;\r\n                    colIndex += colStep\r\n                ) {\r\n                    const cell = this.getCell(this.row, colIndex);\r\n                    if (cell.td && !cell.spanLeft) {\r\n                        const leftCell = colIndex < this.col ? cell : currentCell;\r\n                        const rightCell = colIndex < this.col ? currentCell : cell;\r\n                        this.mergeCells(leftCell, rightCell, true /** horizontally */);\r\n                        break;\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case TableOperation.MergeCells:\r\n                for (let colIndex = firstColumn; colIndex <= lastColumn; colIndex++) {\r\n                    for (let rowIndex = firstRow + 1; rowIndex <= lastRow; rowIndex++) {\r\n                        const cell = this.getCell(firstRow, colIndex);\r\n                        const nextCellBelow = this.getCell(rowIndex, colIndex);\r\n                        this.mergeCells(cell, nextCellBelow);\r\n                    }\r\n                }\r\n                for (let colIndex = firstColumn + 1; colIndex <= lastColumn; colIndex++) {\r\n                    const cell = this.getCell(firstRow, firstColumn);\r\n                    const nextCellRight = this.getCell(firstRow, colIndex);\r\n                    this.mergeCells(cell, nextCellRight, true /** horizontally */);\r\n                }\r\n\r\n                break;\r\n            case TableOperation.DeleteTable:\r\n                this.cells = null;\r\n                break;\r\n\r\n            case TableOperation.SplitVertically:\r\n                if (currentCell.td && currentCell.td.rowSpan > 1) {\r\n                    this.getCell(this.row + 1, this.col).td = cloneNode(currentCell.td);\r\n                } else {\r\n                    const splitRow = currentRow.map(cell => {\r\n                        return {\r\n                            td: cell == currentCell ? cloneNode(cell.td) : null,\r\n                            spanAbove: cell != currentCell,\r\n                            spanLeft: cell.spanLeft,\r\n                        };\r\n                    });\r\n                    this.cells.splice(this.row + 1, 0, splitRow);\r\n                }\r\n                break;\r\n\r\n            case TableOperation.SplitHorizontally:\r\n                if (currentCell.td && currentCell.td.colSpan > 1) {\r\n                    this.getCell(this.row, this.col + 1).td = cloneNode(currentCell.td);\r\n                } else {\r\n                    this.forEachCellOfCurrentColumn((cell, row) => {\r\n                        row.splice(this.col! + 1, 0, {\r\n                            td: row == currentRow ? cloneNode(cell.td) : null,\r\n                            spanAbove: cell.spanAbove,\r\n                            spanLeft: row != currentRow,\r\n                        });\r\n                    });\r\n                }\r\n                break;\r\n            case TableOperation.AlignCenter:\r\n                this.table.style.marginLeft = 'auto';\r\n                this.table.style.marginRight = 'auto';\r\n                break;\r\n            case TableOperation.AlignLeft:\r\n                this.table.style.marginLeft = '';\r\n                this.table.style.marginRight = 'auto';\r\n                break;\r\n            case TableOperation.AlignRight:\r\n                this.table.style.marginLeft = 'auto';\r\n                this.table.style.marginRight = '';\r\n                break;\r\n            case TableOperation.AlignCellCenter:\r\n                this.setAlignmentToSelectedCells(\r\n                    firstRow,\r\n                    lastRow,\r\n                    firstColumn,\r\n                    lastColumn,\r\n                    'center'\r\n                );\r\n                break;\r\n            case TableOperation.AlignCellLeft:\r\n                this.setAlignmentToSelectedCells(\r\n                    firstRow,\r\n                    lastRow,\r\n                    firstColumn,\r\n                    lastColumn,\r\n                    'left'\r\n                );\r\n                break;\r\n            case TableOperation.AlignCellRight:\r\n                this.setAlignmentToSelectedCells(\r\n                    firstRow,\r\n                    lastRow,\r\n                    firstColumn,\r\n                    lastColumn,\r\n                    'right'\r\n                );\r\n                break;\r\n            case TableOperation.AlignCellTop:\r\n                this.setAlignmentToSelectedCells(\r\n                    firstRow,\r\n                    lastRow,\r\n                    firstColumn,\r\n                    lastColumn,\r\n                    'top',\r\n                    true /** isVertical */\r\n                );\r\n                break;\r\n            case TableOperation.AlignCellMiddle:\r\n                this.setAlignmentToSelectedCells(\r\n                    firstRow,\r\n                    lastRow,\r\n                    firstColumn,\r\n                    lastColumn,\r\n                    'middle',\r\n                    true /** isVertical */\r\n                );\r\n                break;\r\n            case TableOperation.AlignCellBottom:\r\n                this.setAlignmentToSelectedCells(\r\n                    firstRow,\r\n                    lastRow,\r\n                    firstColumn,\r\n                    lastColumn,\r\n                    'bottom',\r\n                    true /** isVertical */\r\n                );\r\n                break;\r\n        }\r\n    }\r\n\r\n    setAlignmentToSelectedCells(\r\n        firstRow: number,\r\n        lastRow: number,\r\n        firstColumn: number,\r\n        lastColumn: number,\r\n        alignmentType: string,\r\n        isVertical?: boolean\r\n    ) {\r\n        for (let i = firstRow; i <= lastRow; i++) {\r\n            for (let j = firstColumn; j <= lastColumn; j++) {\r\n                if (this.cells) {\r\n                    const cell = this.cells[i][j].td;\r\n                    if (isVertical && cell) {\r\n                        cell.style?.setProperty('vertical-align', alignmentType);\r\n                        const meta = getTableCellMetadata(cell);\r\n                        saveTableCellMetadata(cell, { ...meta, vAlignOverride: true });\r\n                    } else if (cell) {\r\n                        cell.style?.setProperty('text-align', alignmentType);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private mergeCells(cell: VCell, nextCell: VCell, horizontally?: boolean) {\r\n        const checkSpans = horizontally\r\n            ? cell.td?.rowSpan === nextCell.td?.rowSpan && !cell.spanLeft\r\n            : cell.td?.colSpan === nextCell.td?.colSpan && !cell.spanAbove;\r\n        if (cell.td && nextCell.td && checkSpans) {\r\n            this.mergeCellContents(cell.td, nextCell.td);\r\n            nextCell.td = null;\r\n            if (horizontally) {\r\n                nextCell.spanLeft = true;\r\n            } else {\r\n                nextCell.spanAbove = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    private isEmptyCell(td: HTMLTableCellElement) {\r\n        return td.childElementCount === 1 && getTagOfNode(td.firstChild) === 'BR';\r\n    }\r\n\r\n    private mergeCellContents(cellTd: HTMLTableCellElement, nextCellTd: HTMLTableCellElement) {\r\n        if (this.isEmptyCell(nextCellTd)) {\r\n            moveChildNodes(cellTd, nextCellTd, false /*keepExistingChildren*/);\r\n        } else {\r\n            const br = document.createElement('br');\r\n            cellTd.appendChild(br);\r\n            moveChildNodes(cellTd, nextCellTd, true /*keepExistingChildren*/);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Loop each cell of current column and invoke a callback function\r\n     * @param callback The callback function to invoke\r\n     */\r\n    forEachCellOfCurrentColumn(callback: (cell: VCell, row: VCell[], i: number) => any) {\r\n        this.forEachCellOfColumn(this.col, callback);\r\n    }\r\n\r\n    /**\r\n     * Loop each table cell and get all the cells that share the same border from one side\r\n     * The result is an array of table cell elements\r\n     * @param borderPos The position of the border\r\n     * @param getLeftCells Get left-hand-side or right-hand-side cells of the border\r\n     *\r\n     * Example, consider having a 3 by 4 table as below with merged and split cells\r\n     *\r\n     *     | 1 | 4 | 7 | 8 |\r\n     *     |   5   |   9   |\r\n     *     |   3   |   10  |\r\n     *\r\n     *  input => borderPos: the 3rd border, getLeftCells: true\r\n     *  output => [4, 5, 3]\r\n     *\r\n     *  input => borderPos: the 3rd border, getLeftCells: false\r\n     *  output => [7, 9, 10]\r\n     *\r\n     *  input => borderPos: the 2nd border, getLeftCells: true\r\n     *  output => [1]\r\n     *\r\n     *  input => borderPos: the 2nd border, getLeftCells: false\r\n     *  output => [4]\r\n     */\r\n    getCellsWithBorder(borderPos: number, getLeftCells: boolean): HTMLTableCellElement[] {\r\n        const cells: HTMLTableCellElement[] = [];\r\n        for (let i = 0; this.cells && i < this.cells.length; i++) {\r\n            for (let j = 0; j < this.cells[i].length; j++) {\r\n                const cell = this.getCell(i, j);\r\n                if (cell.td) {\r\n                    const cellRect = normalizeRect(cell.td.getBoundingClientRect());\r\n\r\n                    if (cellRect) {\r\n                        let found: boolean = false;\r\n                        if (getLeftCells) {\r\n                            if (cellRect.right == borderPos) {\r\n                                found = true;\r\n                                cells.push(cell.td);\r\n                            } else if (found) {\r\n                                break;\r\n                            }\r\n                        } else {\r\n                            if (cellRect.left == borderPos) {\r\n                                found = true;\r\n                                cells.push(cell.td);\r\n                            } else if (found) {\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return cells;\r\n    }\r\n\r\n    /**\r\n     * Loop each cell of current row and invoke a callback function\r\n     * @param callback The callback function to invoke\r\n     */\r\n    forEachCellOfCurrentRow(callback: (cell: VCell, i: number) => any) {\r\n        this.forEachCellOfRow(this.row, callback);\r\n    }\r\n\r\n    /**\r\n     * Get a table cell using its row and column index. This function will always return an object\r\n     * even if the given indexes don't exist in table.\r\n     * @param row The row index\r\n     * @param col The column index\r\n     */\r\n    getCell(row: number, col: number): VCell {\r\n        return (this.cells && this.cells[row] && this.cells[row][col]) || {};\r\n    }\r\n\r\n    /**\r\n     * Get current HTML table cell object. If the current table cell is a virtual expanded cell, return its root cell\r\n     */\r\n    getCurrentTd(): HTMLTableCellElement | null {\r\n        return this.getTd(this.row, this.col);\r\n    }\r\n\r\n    /**\r\n     * Get the Table Cell in a provided coordinate\r\n     * @param row row of the cell\r\n     * @param col column of the cell\r\n     */\r\n    getTd(row: number | undefined, col: number | undefined) {\r\n        if (this.cells && row !== undefined && col !== undefined) {\r\n            row = Math.min(this.cells.length - 1, row);\r\n            col = this.cells[row] ? Math.min(this.cells[row].length - 1, col) : col;\r\n            if (!isNaN(row) && !isNaN(col)) {\r\n                while (row >= 0 && col >= 0) {\r\n                    const cell = this.getCell(row, col);\r\n                    if (cell.td) {\r\n                        return cell.td;\r\n                    } else if (cell.spanLeft) {\r\n                        col--;\r\n                    } else if (cell.spanAbove) {\r\n                        row--;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private forEachCellOfColumn(\r\n        col: number | undefined,\r\n        callback: (cell: VCell, row: VCell[], i: number) => any\r\n    ) {\r\n        if (col !== undefined) {\r\n            for (let i = 0; this.cells && i < this.cells.length; i++) {\r\n                callback(this.getCell(i, col), this.cells[i], i);\r\n            }\r\n        }\r\n    }\r\n\r\n    private forEachCellOfRow(row: number | undefined, callback: (cell: VCell, i: number) => any) {\r\n        if (row !== undefined) {\r\n            for (let i = 0; this.cells && i < this.cells[row].length; i++) {\r\n                callback(this.getCell(row, i), i);\r\n            }\r\n        }\r\n    }\r\n\r\n    private recalculateSpans(row: number, col: number) {\r\n        const td = this.getCell(row, col).td;\r\n        if (td) {\r\n            td.colSpan = this.countSpanLeft(row, col);\r\n            td.rowSpan = this.countSpanAbove(row, col);\r\n            if (td.colSpan == 1) {\r\n                td.removeAttribute('colSpan');\r\n            }\r\n            if (td.rowSpan == 1) {\r\n                td.removeAttribute('rowSpan');\r\n            }\r\n        }\r\n    }\r\n\r\n    private countSpanLeft(row: number, col: number) {\r\n        let result = 1;\r\n        for (let i = col + 1; this.cells && i < this.cells[row].length; i++) {\r\n            const cell = this.getCell(row, i);\r\n            if (cell.td || !cell.spanLeft) {\r\n                break;\r\n            }\r\n            result++;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private countSpanAbove(row: number, col: number) {\r\n        let result = 1;\r\n        for (let i = row + 1; this.cells && i < this.cells.length; i++) {\r\n            const cell = this.getCell(i, col);\r\n            if (cell.td || !cell.spanAbove) {\r\n                break;\r\n            }\r\n            result++;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private normalizeEmptyTableCells() {\r\n        for (let i = 0, row; (row = this.table.rows[i]); i++) {\r\n            for (let j = 0, cell; (cell = row.cells[j]); j++) {\r\n                if (cell) {\r\n                    if (!cell.innerHTML || !cell.innerHTML.trim()) {\r\n                        cell.appendChild(document.createElement('br'));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* normalize width/height for each cell in the table */\r\n    public normalizeTableCellSize(zoomScale?: number | SizeTransformer) {\r\n        // remove width/height for each row\r\n        for (let i = 0, row; (row = this.table.rows[i]); i++) {\r\n            row.removeAttribute('width');\r\n            row.style.setProperty('width', null);\r\n            row.removeAttribute('height');\r\n            row.style.setProperty('height', null);\r\n        }\r\n\r\n        // set width/height for each cell\r\n        for (let i = 0; this.cells && i < this.cells.length; i++) {\r\n            for (let j = 0; j < this.cells[i].length; j++) {\r\n                const cell = this.cells[i][j];\r\n                if (cell) {\r\n                    const func =\r\n                        typeof zoomScale == 'number' ? (n: number) => n / zoomScale : zoomScale;\r\n                    const width = cell.width || 0;\r\n                    const height = cell.height || 0;\r\n\r\n                    setHTMLElementSizeInPx(\r\n                        cell.td,\r\n                        func?.(width) || width,\r\n                        func?.(height) || height\r\n                    );\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private normalizeSize(sizeTransformer: SizeTransformer | undefined) {\r\n        this.normalizeEmptyTableCells();\r\n        this.normalizeTableCellSize(sizeTransformer);\r\n\r\n        const rect = this.table.getBoundingClientRect();\r\n\r\n        // Make sure table width/height is fixed to avoid shifting effect\r\n        setHTMLElementSizeInPx(\r\n            this.table,\r\n            sizeTransformer?.(rect.width) || rect.width,\r\n            sizeTransformer?.(rect.height) || rect.height\r\n        );\r\n    }\r\n}\r\n\r\nfunction setHTMLElementSizeInPx(\r\n    element: HTMLElement | null | undefined,\r\n    newWidth: number,\r\n    newHeight: number\r\n) {\r\n    if (!!element) {\r\n        element.removeAttribute('width');\r\n        element.removeAttribute('height');\r\n        element.style.boxSizing = 'border-box';\r\n        element.style.width = `${newWidth}px`;\r\n        element.style.height = `${newHeight}px`;\r\n    }\r\n}\r\n\r\nfunction getTableFromTd(td: HTMLTableCellElement) {\r\n    let result: Element | null = <HTMLElement>td;\r\n    for (; result && result.tagName != 'TABLE'; result = result.parentElement) {}\r\n    return <HTMLTableElement>result;\r\n}\r\n\r\n/**\r\n * Clone a table cell\r\n * @param cell The cell to clone\r\n */\r\nfunction cloneCell(cell: VCell): VCell {\r\n    return {\r\n        td: cloneNode(cell.td),\r\n        spanAbove: cell.spanAbove,\r\n        spanLeft: cell.spanLeft,\r\n    };\r\n}\r\n\r\n/**\r\n * Clone a node without its children.\r\n * @param node The node to clone\r\n */\r\nfunction cloneNode<T extends Node>(node: T | null | undefined): T | null {\r\n    const newNode = node ? <T>node.cloneNode(false /*deep*/) : null;\r\n    if (safeInstanceOf(newNode, 'HTMLTableCellElement')) {\r\n        newNode.removeAttribute('id');\r\n        if (!newNode.firstChild) {\r\n            newNode.appendChild(node!.ownerDocument!.createElement('br'));\r\n        }\r\n    }\r\n    return newNode;\r\n}\r\n"]}