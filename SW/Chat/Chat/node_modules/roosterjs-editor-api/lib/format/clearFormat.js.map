{"version":3,"file":"clearFormat.js","sourceRoot":"","sources":["../../../../packages/roosterjs-editor-api/lib/format/clearFormat.ts"],"names":[],"mappings":";;;AAAA,gEAAgE;AAChE,oDAA+C;AAC/C,oDAA+C;AAC/C,kEAA6D;AAC7D,2DAAsD;AACtD,6CAAwC;AACxC,6CAAwC;AACxC,+CAA0C;AAC1C,2CAAsC;AACtC,+CAA0C;AAC1C,qDAAgD;AAGhD,6DAiB8B;AAG9B,IAAM,gBAAgB,GAAG,CAAC,MAAM,EAAE,iBAAiB,EAAE,OAAO,EAAE,YAAY,CAAC,CAAC;AAC5E,IAAM,cAAc,GAAG,oGAAoG,CAAC,KAAK,CAC7H,GAAG,CACN,CAAC;AACF,IAAM,sBAAsB,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,aAAa,EAAE,aAAa,CAAC,CAAC;AAC7E,IAAM,mBAAmB,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;AAE1E;;;GAGG;AACH,SAAS,qBAAqB,CAAC,MAAe;IAC1C,IAAM,WAAW,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;IACnD,IAAM,YAAY,GAAG,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,mBAAmB,CAAC;IACtD,IAAI,CAAC,YAAY,EAAE;QACf,OAAO,KAAK,CAAC;KAChB;IAED,IAAM,gBAAgB,GAAG,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,mBAAmB,EAAE,CAAC;IAE5D,kCAAkC;IAClC,OAAO,CAAC,CAAC,gBAAgB,CAAC;AAC9B,CAAC;AAED,SAAS,eAAe,CAAC,IAAU;IAC/B,qDAAqD;IACrD,IAAM,gBAAgB,GAAG,IAAA,8BAAO,EAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;IACvE,IAAM,mBAAmB,GAAG,gBAAgB,CAAC,KAAK,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,EAAD,CAAC,CAAC,CAAC;IAC3D,IAAM,kBAAkB,GAAG,IAAA,qCAAc,EAAC,IAAI,CAAC,CAAC;IAEhD,iCAAiC;IACjC,IAAM,GAAG,GAAG,IAAA,mCAAY,EAAC,IAAI,CAAC,CAAC;IAC/B,IAAI,GAAG,EAAE;QACL,IACI,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;YAChC,CAAC,mBAAmB;gBAChB,CAAC,IAAA,wCAAiB,EAAC,IAAI,CAAC;gBACxB,mBAAmB,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAC3C;YACE,IAAI,kBAAkB,IAAI,CAAC,mBAAmB,EAAE;gBAC5C,IAAA,2BAAI,EAAC,IAAI,CAAC,CAAC;aACd;YACD,IAAA,6BAAM,EAAC,IAAI,CAAC,CAAC;SAChB;aAAM;YACH,sCAAsC;YACtC,cAAc,CAAC,IAAmB,CAAC,CAAC;SACvC;KACJ;IAED,OAAO,kBAAkB,CAAC;AAC9B,CAAC;AAED,SAAS,cAAc,CAAC,OAAoB;;IACxC,IAAM,WAAW,GAAG,IAAA,qCAAc,EAAC,OAAO,EAAE,sBAAsB,CAAC,CAAC;IACpE,IAAM,OAAO,GAAG,IAAA,qCAAc,EAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;;QAE5D,KAAmB,IAAA,KAAA,sBAAA,IAAA,8BAAO,EAAC,OAAO,CAAC,UAAU,CAAC,CAAA,gBAAA,4BAAE;YAA3C,IAAM,IAAI,WAAA;YACX,IAAI,WAAW,IAAI,IAAI,CAAC,IAAI,IAAI,OAAO,EAAE;gBACrC,qBAAqB,CAAC,OAAO,CAAC,CAAC;aAClC;iBAAM,IAAI,OAAO,IAAI,IAAI,CAAC,IAAI,IAAI,OAAO,EAAE;gBACxC,2BAA2B,CAAC,OAAO,CAAC,CAAC;aACxC;iBAAM,IACH,sBAAsB,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC;gBAC3D,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EACjC;gBACE,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACtC;SACJ;;;;;;;;;AACL,CAAC;AAED,SAAS,YAAY,CACjB,OAAoB,EACpB,UAIS;IAET,IAAM,MAAM,GAAG,IAAA,gCAAS,EAAC,OAAO,CAAC,CAAC;IAClC,IAAM,MAAM,GAA2B,EAAE,CAAC;IAE1C,IAAA,oCAAa,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAA,KAAK,IAAI,OAAA,UAAU,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,EAAjC,CAAiC,CAAC,CAAC;IAE1E,IAAA,gCAAS,EAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAE3B,OAAO,MAAM,CAAC;AAClB,CAAC;AAED,SAAS,qBAAqB,CAAC,OAAoB;IAC/C,OAAO,YAAY,CAAC,OAAO,EAAE,UAAC,IAAI,EAAE,MAAM,EAAE,MAAM;QAC9C,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;YAC5B,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;YAC5B,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;SACvB;IACL,CAAC,CAAC,CAAC;AACP,CAAC;AAED,SAAS,2BAA2B,CAAC,OAAyB;IAC1D,OAAO,YAAY,CAAC,OAAO,EAAE,UAAC,IAAI,EAAE,MAAM,EAAE,MAAM;QAC9C,IAAI,IAAI,IAAI,iBAAiB,EAAE;YAC3B,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;YAC5B,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;SACvB;IACL,CAAC,CAAC,CAAC;AACP,CAAC;AAED;;;;GAIG;AACH,SAAS,gBAAgB,CAAC,IAAU,EAAE,MAAe;;IACjD,IAAI,WAAW,GAA6B,IAAI,CAAC;;QAE7C,IAAI,WAAW,CAAC,WAAW,IAAI,WAAW,CAAC,eAAe,EAAE;YACxD,IAAI,IAAA,qCAAc,EAAC,WAAW,EAAE,eAAe,CAAC,EAAE;gCACvC,IAAI;aACd;YACD,IAAI,0BAAwB,GAAG,IAAI,CAAC;YACpC,MAAA,WAAW,CAAC,UAAU,0CAAE,UAAU,CAAC,OAAO,CAAC,UAAA,IAAI;;gBAC3C,IAAI,IAAI,IAAI,WAAW,KAAI,MAAA,IAAI,CAAC,WAAW,0CAAE,MAAM,CAAA,EAAE;oBACjD,0BAAwB,GAAG,KAAK,CAAC;iBACpC;YACL,CAAC,CAAC,CAAC;4BACI,0BAAwB;SAClC;QACD,WAAW,GAAG,WAAW,CAAC,UAAU,CAAC;;IAbzC,OAAO,WAAW,IAAI,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,UAAU,CAAC;;;;KAc5D;IACD,OAAO,IAAI,CAAC;AAChB,CAAC;AAED;;;;;GAKG;AACH,SAAS,qBAAqB,CAAC,MAAe;IAC1C,IAAM,YAAY,GAAG,qBAAqB,CAAC,MAAM,CAAC,CAAC;IACnD,IAAI,CAAC,YAAY,EAAE;QACf,IAAM,WAAW,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;QACnD,IAAM,aAAa,GAAG,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,oBAAoB,CAAC;QACxD,IAAM,SAAS,GACX,aAAa,YAAY,2CAAoB;YAC7C,CAAC,aAAa,YAAY,wCAAiB;gBACvC,CAAC,gBAAgB,CAAC,aAAa,CAAC,gBAAgB,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC;QACrE,IAAI,SAAS,EAAE;YACX,WAAW,CAAC,MAAM,CAAC,CAAC;YACpB,OAAO;SACV;KACJ;IACD,gBAAgB,CAAC,MAAM,CAAC,CAAC;AAC7B,CAAC;AAED;;;;GAIG;AACH,SAAS,gBAAgB,CAAC,MAAe;IACrC,IAAA,4BAAkB,EACd,MAAM,EACN;QACI,IAAA,qBAAW,EAAC,MAAM,EAAE,UAAA,MAAM;YACtB,IAAM,MAAM,GAAG,IAAA,uDAAgC,EAAC,MAAM,CAAC,CAAC;YACxD,IAAI,KAAK,GAAG,IAAA,4CAAqB,EAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAElD,IAAI,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;gBAClC,gGAAgG;gBAChG,0FAA0F;gBAC1F,IAAM,eAAe,GAAG,qBAAqB,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAC/D,IAAI,IAAA,oCAAa,EAAC,eAAe,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC3C,IAAM,OAAO,GAAG,IAAA,2BAAI,EAAC,IAAA,8BAAO,EAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;oBAC1D,IAAA,gCAAS,EAAC,OAAO,EAAE,eAAe,CAAC,CAAC;iBACvC;aACJ;YAED,OACI,KAAK,CAAC,MAAM,GAAG,CAAC;gBAChB,KAAK,CAAC,CAAC,CAAC,CAAC,UAAU;gBACnB,IAAA,qCAAc,EAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,EAC7C;gBACE,IAAM,aAAa,GAAG,IAAA,6CAAsB,EAAC,KAAK,CAAC,CAAC;gBACpD,KAAK,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;aAChD;YAED,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;QACH,gBAAgB,CAAC,MAAM,CAAC,CAAC;IAC7B,CAAC,EACD,kBAAkB,CACrB,CAAC;AACN,CAAC;AAED,SAAS,iBAAiB,CAAC,MAAe;IACtC,MAAM,CAAC,KAAK,EAAE,CAAC;IACf,MAAM,CAAC,eAAe,CAAC;QACnB,IAAA,qBAAW,EAAC,MAAM,oCAA+B,CAAC;QAClD,MAAM,CAAC,aAAa,CAAC,SAAS,uBAA0B,UAAA,IAAI;YACxD,OAAA,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC;QAA7B,CAA6B,CAChC,CAAC;QAEF,gBAAgB,CAAC,MAAM,CAAC,CAAC;QAEzB,OAAO,mBAAmB,CAAC;IAC/B,CAAC,wBAAsB,CAAC;AAC5B,CAAC;AAED,SAAS,oBAAoB,CAAC,MAAe,EAAE,UAA0B;IAA1B,2BAAA,EAAA,kBAA0B;IACrE,IAAA,2BAAsB,EAClB,MAAM,EACN,aAAa,EACb,UAAA,OAAO,IAAI,OAAA,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,UAAU,CAAC,EAAvC,CAAuC,EAClD,sBAAsB,CACzB,CAAC;AACN,CAAC;AAED,SAAS,gBAAgB,CAAC,MAAe;IACrC,IAAM,aAAa,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;IAChD,IAAM,oBAAoB,GAAG,IAAA,oCAAa,EAAC,aAAa,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC;IACvE,MAAM,CAAC,aAAa,CAAC,SAAS,uBAA0B,UAAA,IAAI;QACxD,IAAM,GAAG,GAAG,IAAA,mCAAY,EAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,mBAAmB,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;YACxC,YAAY,CAAC,GAAG,EAAE,IAAI,EAAE,oBAAoB,CAAC,CAAC;SACjD;aAAM;YACH,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,IAAI;gBACxB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,KAAK;oBACzB,IAAM,GAAG,GAAG,IAAA,mCAAY,EAAC,KAAK,CAAC,CAAC;oBAChC,IAAI,IAAA,qCAAc,EAAC,KAAK,EAAE,aAAa,CAAC,EAAE;wBACtC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,oBAAoB,CAAC,CAAC;qBAClD;gBACL,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;SACN;IACL,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,oBAAoB,EAAE;QACvB,IAAI,aAAa,CAAC,UAAU,EAAE;YAC1B,IAAA,qBAAW,EAAC,MAAM,EAAE,aAAa,CAAC,UAAU,CAAC,CAAC;SACjD;QACD,IAAI,aAAa,CAAC,QAAQ,EAAE;YACxB,IAAA,qBAAW,EAAC,MAAM,EAAE,aAAa,CAAC,QAAQ,CAAC,CAAC;SAC/C;QACD,IAAI,aAAa,CAAC,SAAS,EAAE;YACzB,IAAM,yBAAuB,GAAG,MAAM,CAAC,aAAa,CAChD,QAAQ,sBAEX,CAAC;YAEF,IAAM,sBAAsB,GACxB,yBAAuB,CAAC,MAAM,GAAG,CAAC;gBAC9B,CAAC,CAAC,UAAC,OAAoB,IAAK,OAAA,yBAAuB,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAA9C,CAA8C;gBAC1E,CAAC,CAAC,SAAS,CAAC;YAEpB,IAAI,aAAa,CAAC,UAAU,EAAE;gBAC1B,IAAA,sBAAY,EAAC,MAAM,EAAE,aAAa,CAAC,UAAU,EAAE,sBAAsB,CAAC,CAAC;aAC1E;iBAAM;gBACH,IAAA,sBAAY,EAAC,MAAM,EAAE,aAAa,CAAC,SAAS,EAAE,sBAAsB,CAAC,CAAC;aACzE;SACJ;QACD,IAAI,aAAa,CAAC,eAAe,EAAE;YAC/B,IAAI,aAAa,CAAC,gBAAgB,EAAE;gBAChC,IAAA,4BAAkB,EAAC,MAAM,EAAE,aAAa,CAAC,gBAAgB,CAAC,CAAC;aAC9D;iBAAM;gBACH,IAAA,4BAAkB,EAAC,MAAM,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;aAC7D;SACJ;QACD,IAAI,aAAa,CAAC,IAAI,EAAE;YACpB,IAAA,oBAAU,EAAC,MAAM,CAAC,CAAC;SACtB;aAAM;YACH,oBAAoB,CAAC,MAAM,CAAC,CAAC;SAChC;QACD,IAAI,aAAa,CAAC,MAAM,EAAE;YACtB,IAAA,sBAAY,EAAC,MAAM,CAAC,CAAC;SACxB;QACD,IAAI,aAAa,CAAC,SAAS,EAAE;YACzB,IAAA,yBAAe,EAAC,MAAM,CAAC,CAAC;SAC3B;KACJ;AACL,CAAC;AAED,SAAS,YAAY,CAAC,GAAW,EAAE,IAAiB,EAAE,oBAA6B;IAC/E,IAAI,mBAAmB,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;QACxC,gBAAgB,CAAC,OAAO,CAAC,UAAA,KAAK,IAAI,OAAA,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,EAAhC,CAAgC,CAAC,CAAC;QAEpE,sGAAsG;QACtG,0EAA0E;QAC1E,IAAI,oBAAoB,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE;YAC3D,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;SACjC;KACJ;AACL,CAAC;AAED;;;;;;GAMG;AACH,SAAwB,WAAW,CAC/B,MAAe,EACf,UAAgF;IAAhF,2BAAA,EAAA,2BAAgF;IAEhF,QAAQ,UAAU,EAAE;QAChB;YACI,iBAAiB,CAAC,MAAM,CAAC,CAAC;YAC1B,MAAM;QACV;YACI,gBAAgB,CAAC,MAAM,CAAC,CAAC;YACzB,MAAM;QACV;YACI,qBAAqB,CAAC,MAAM,CAAC,CAAC;KACrC;AACL,CAAC;AAdD,8BAcC","sourcesContent":["import applyListItemStyleWrap from '../utils/applyListItemWrap';\r\nimport blockFormat from '../utils/blockFormat';\r\nimport execCommand from '../utils/execCommand';\r\nimport formatUndoSnapshot from '../utils/formatUndoSnapshot';\r\nimport setBackgroundColor from './setBackgroundColor';\r\nimport setFontName from './setFontName';\r\nimport setFontSize from './setFontSize';\r\nimport setTextColor from './setTextColor';\r\nimport toggleBold from './toggleBold';\r\nimport toggleItalic from './toggleItalic';\r\nimport toggleUnderline from './toggleUnderline';\r\nimport { ChangeSource, ClearFormatMode, DocumentCommand, QueryScope } from 'roosterjs-editor-types';\r\nimport type { IEditor } from 'roosterjs-editor-types';\r\nimport {\r\n    collapseNodesInRegion,\r\n    getObjectKeys,\r\n    getSelectedBlockElementsInRegion,\r\n    getStyles,\r\n    getTagOfNode,\r\n    isBlockElement,\r\n    isNodeInRegion,\r\n    isVoidHtmlElement,\r\n    PartialInlineElement,\r\n    NodeInlineElement,\r\n    safeInstanceOf,\r\n    setStyles,\r\n    splitBalancedNodeRange,\r\n    toArray,\r\n    unwrap,\r\n    wrap,\r\n} from 'roosterjs-editor-dom';\r\nimport type { CompatibleClearFormatMode } from 'roosterjs-editor-types/lib/compatibleTypes';\r\n\r\nconst STYLES_TO_REMOVE = ['font', 'text-decoration', 'color', 'background'];\r\nconst TAGS_TO_UNWRAP = 'B,I,U,STRONG,EM,SUB,SUP,STRIKE,FONT,CENTER,H1,H2,H3,H4,H5,H6,UL,OL,LI,SPAN,P,BLOCKQUOTE,CODE,S,PRE'.split(\r\n    ','\r\n);\r\nconst ATTRIBUTES_TO_PRESERVE = ['href', 'src', 'cellpadding', 'cellspacing'];\r\nconst TAGS_TO_STOP_UNWRAP = ['TD', 'TH', 'TR', 'TABLE', 'TBODY', 'THEAD'];\r\n\r\n/**\r\n * @param editor The editor instance\r\n * @returns if the current selection is composed of two or more block elements\r\n */\r\nfunction isMultiBlockSelection(editor: IEditor): boolean {\r\n    const transverser = editor.getSelectionTraverser();\r\n    const blockElement = transverser?.currentBlockElement;\r\n    if (!blockElement) {\r\n        return false;\r\n    }\r\n\r\n    const nextBlockElement = transverser?.getNextBlockElement();\r\n\r\n    //At least two blocks are selected\r\n    return !!nextBlockElement;\r\n}\r\n\r\nfunction clearNodeFormat(node: Node): boolean {\r\n    // 1. Recursively clear format of all its child nodes\r\n    const areBlockElements = toArray(node.childNodes).map(clearNodeFormat);\r\n    const areAllChildrenBlock = areBlockElements.every(b => b);\r\n    const returnBlockElement = isBlockElement(node);\r\n\r\n    // 2. Unwrap the tag if necessary\r\n    const tag = getTagOfNode(node);\r\n    if (tag) {\r\n        if (\r\n            TAGS_TO_UNWRAP.indexOf(tag) >= 0 ||\r\n            (areAllChildrenBlock &&\r\n                !isVoidHtmlElement(node) &&\r\n                TAGS_TO_STOP_UNWRAP.indexOf(tag) < 0)\r\n        ) {\r\n            if (returnBlockElement && !areAllChildrenBlock) {\r\n                wrap(node);\r\n            }\r\n            unwrap(node);\r\n        } else {\r\n            // 3. Otherwise, remove all attributes\r\n            clearAttribute(node as HTMLElement);\r\n        }\r\n    }\r\n\r\n    return returnBlockElement;\r\n}\r\n\r\nfunction clearAttribute(element: HTMLElement) {\r\n    const isTableCell = safeInstanceOf(element, 'HTMLTableCellElement');\r\n    const isTable = safeInstanceOf(element, 'HTMLTableElement');\r\n\r\n    for (const attr of toArray(element.attributes)) {\r\n        if (isTableCell && attr.name == 'style') {\r\n            removeNonBorderStyles(element);\r\n        } else if (isTable && attr.name == 'style') {\r\n            removeNotTableDefaultStyles(element);\r\n        } else if (\r\n            ATTRIBUTES_TO_PRESERVE.indexOf(attr.name.toLowerCase()) < 0 &&\r\n            attr.name.indexOf('data-') != 0\r\n        ) {\r\n            element.removeAttribute(attr.name);\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateStyles(\r\n    element: HTMLElement,\r\n    callbackfn: (\r\n        value: string,\r\n        styles: Record<string, string>,\r\n        result: Record<string, string>\r\n    ) => void\r\n) {\r\n    const styles = getStyles(element);\r\n    const result: Record<string, string> = {};\r\n\r\n    getObjectKeys(styles).forEach(style => callbackfn(style, styles, result));\r\n\r\n    setStyles(element, styles);\r\n\r\n    return result;\r\n}\r\n\r\nfunction removeNonBorderStyles(element: HTMLElement): Record<string, string> {\r\n    return updateStyles(element, (name, styles, result) => {\r\n        if (name.indexOf('border') < 0) {\r\n            result[name] = styles[name];\r\n            delete styles[name];\r\n        }\r\n    });\r\n}\r\n\r\nfunction removeNotTableDefaultStyles(element: HTMLTableElement) {\r\n    return updateStyles(element, (name, styles, result) => {\r\n        if (name != 'border-collapse') {\r\n            result[name] = styles[name];\r\n            delete styles[name];\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Verifies recursively if a node and its parents have any siblings with text content\r\n * Ignoring the children of contentDiv and returning true if any node is LI\r\n * @returns `true` if this node, and its parents (minus the children of the contentDiv) have no siblings with text content\r\n */\r\nfunction isNodeWholeBlock(node: Node, editor: IEditor) {\r\n    let currentNode: ParentNode | Node | null = node;\r\n    while (currentNode && editor.contains(currentNode.parentNode)) {\r\n        if (currentNode.nextSibling || currentNode.previousSibling) {\r\n            if (safeInstanceOf(currentNode, 'HTMLLIElement')) {\r\n                return true;\r\n            }\r\n            let isOnlySiblingWithContent = true;\r\n            currentNode.parentNode?.childNodes.forEach(node => {\r\n                if (node != currentNode && node.textContent?.length) {\r\n                    isOnlySiblingWithContent = false;\r\n                }\r\n            });\r\n            return isOnlySiblingWithContent;\r\n        }\r\n        currentNode = currentNode.parentNode;\r\n    }\r\n    return true;\r\n}\r\n\r\n/**\r\n * Clear the format of the selected text or list of blocks\r\n * If the current selection is compose of multiple block elements then remove the text and struture format for all the selected blocks\r\n * If the current selection is compose of a partial inline element then only the text format is removed from the current selection\r\n * @param editor The editor instance\r\n */\r\nfunction clearAutoDetectFormat(editor: IEditor) {\r\n    const isMultiBlock = isMultiBlockSelection(editor);\r\n    if (!isMultiBlock) {\r\n        const transverser = editor.getSelectionTraverser();\r\n        const inlineElement = transverser?.currentInlineElement;\r\n        const isPartial =\r\n            inlineElement instanceof PartialInlineElement ||\r\n            (inlineElement instanceof NodeInlineElement &&\r\n                !isNodeWholeBlock(inlineElement.getContainerNode(), editor));\r\n        if (isPartial) {\r\n            clearFormat(editor);\r\n            return;\r\n        }\r\n    }\r\n    clearBlockFormat(editor);\r\n}\r\n\r\n/**\r\n * Clear all formats of selected blocks.\r\n * When selection is collapsed, only clear format of current block.\r\n * @param editor The editor instance\r\n */\r\nfunction clearBlockFormat(editor: IEditor) {\r\n    formatUndoSnapshot(\r\n        editor,\r\n        () => {\r\n            blockFormat(editor, region => {\r\n                const blocks = getSelectedBlockElementsInRegion(region);\r\n                let nodes = collapseNodesInRegion(region, blocks);\r\n\r\n                if (editor.contains(region.rootNode)) {\r\n                    // If there are styles on table cell, wrap all its children and move down all non-border styles.\r\n                    // So that we can preserve styles for unselected blocks as well as border styles for table\r\n                    const nonborderStyles = removeNonBorderStyles(region.rootNode);\r\n                    if (getObjectKeys(nonborderStyles).length > 0) {\r\n                        const wrapper = wrap(toArray(region.rootNode.childNodes));\r\n                        setStyles(wrapper, nonborderStyles);\r\n                    }\r\n                }\r\n\r\n                while (\r\n                    nodes.length > 0 &&\r\n                    nodes[0].parentNode &&\r\n                    isNodeInRegion(region, nodes[0].parentNode)\r\n                ) {\r\n                    const balancedNodes = splitBalancedNodeRange(nodes);\r\n                    nodes = balancedNodes ? [balancedNodes] : [];\r\n                }\r\n\r\n                nodes.forEach(clearNodeFormat);\r\n            });\r\n            setDefaultFormat(editor);\r\n        },\r\n        'clearBlockFormat'\r\n    );\r\n}\r\n\r\nfunction clearInlineFormat(editor: IEditor) {\r\n    editor.focus();\r\n    editor.addUndoSnapshot(() => {\r\n        execCommand(editor, DocumentCommand.RemoveFormat);\r\n        editor.queryElements('[class]', QueryScope.OnSelection, node =>\r\n            node.removeAttribute('class')\r\n        );\r\n\r\n        setDefaultFormat(editor);\r\n\r\n        return 'clearInlineFormat';\r\n    }, ChangeSource.Format);\r\n}\r\n\r\nfunction setDefaultFontWeight(editor: IEditor, fontWeight: string = '400') {\r\n    applyListItemStyleWrap(\r\n        editor,\r\n        'font-weight',\r\n        element => (element.style.fontWeight = fontWeight),\r\n        'setDefaultFontWeight'\r\n    );\r\n}\r\n\r\nfunction setDefaultFormat(editor: IEditor) {\r\n    const defaultFormat = editor.getDefaultFormat();\r\n    const isDefaultFormatEmpty = getObjectKeys(defaultFormat).length === 0;\r\n    editor.queryElements('[style]', QueryScope.InSelection, node => {\r\n        const tag = getTagOfNode(node);\r\n        if (TAGS_TO_STOP_UNWRAP.indexOf(tag) == -1) {\r\n            removeStyles(tag, node, isDefaultFormatEmpty);\r\n        } else {\r\n            node.childNodes.forEach(node => {\r\n                node.childNodes.forEach(cNode => {\r\n                    const tag = getTagOfNode(cNode);\r\n                    if (safeInstanceOf(cNode, 'HTMLElement')) {\r\n                        removeStyles(tag, cNode, isDefaultFormatEmpty);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    });\r\n\r\n    if (!isDefaultFormatEmpty) {\r\n        if (defaultFormat.fontFamily) {\r\n            setFontName(editor, defaultFormat.fontFamily);\r\n        }\r\n        if (defaultFormat.fontSize) {\r\n            setFontSize(editor, defaultFormat.fontSize);\r\n        }\r\n        if (defaultFormat.textColor) {\r\n            const setColorIgnoredElements = editor.queryElements<HTMLElement>(\r\n                'a *, a',\r\n                QueryScope.OnSelection\r\n            );\r\n\r\n            const shouldApplyInlineStyle =\r\n                setColorIgnoredElements.length > 0\r\n                    ? (element: HTMLElement) => setColorIgnoredElements.indexOf(element) == -1\r\n                    : undefined;\r\n\r\n            if (defaultFormat.textColors) {\r\n                setTextColor(editor, defaultFormat.textColors, shouldApplyInlineStyle);\r\n            } else {\r\n                setTextColor(editor, defaultFormat.textColor, shouldApplyInlineStyle);\r\n            }\r\n        }\r\n        if (defaultFormat.backgroundColor) {\r\n            if (defaultFormat.backgroundColors) {\r\n                setBackgroundColor(editor, defaultFormat.backgroundColors);\r\n            } else {\r\n                setBackgroundColor(editor, defaultFormat.backgroundColor);\r\n            }\r\n        }\r\n        if (defaultFormat.bold) {\r\n            toggleBold(editor);\r\n        } else {\r\n            setDefaultFontWeight(editor);\r\n        }\r\n        if (defaultFormat.italic) {\r\n            toggleItalic(editor);\r\n        }\r\n        if (defaultFormat.underline) {\r\n            toggleUnderline(editor);\r\n        }\r\n    }\r\n}\r\n\r\nfunction removeStyles(tag: string, node: HTMLElement, isDefaultFormatEmpty: boolean) {\r\n    if (TAGS_TO_STOP_UNWRAP.indexOf(tag) == -1) {\r\n        STYLES_TO_REMOVE.forEach(style => node.style.removeProperty(style));\r\n\r\n        // when default format is empty, keep the HTML minimum by removing style attribute if there's no style\r\n        // (note: because default format is empty, we're not adding style back in)\r\n        if (isDefaultFormatEmpty && node.getAttribute('style') === '') {\r\n            node.removeAttribute('style');\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Clear the format in current selection, after cleaning, the format will be\r\n * changed to default format. The format that get cleaned include B/I/U/font name/\r\n * font size/text color/background color/align left/align right/align center/superscript/subscript\r\n * @param editor The editor instance\r\n * @param formatType type of format to apply\r\n */\r\nexport default function clearFormat(\r\n    editor: IEditor,\r\n    formatType: ClearFormatMode | CompatibleClearFormatMode = ClearFormatMode.Inline\r\n) {\r\n    switch (formatType) {\r\n        case ClearFormatMode.Inline:\r\n            clearInlineFormat(editor);\r\n            break;\r\n        case ClearFormatMode.Block:\r\n            clearBlockFormat(editor);\r\n            break;\r\n        default:\r\n            clearAutoDetectFormat(editor);\r\n    }\r\n}\r\n"]}