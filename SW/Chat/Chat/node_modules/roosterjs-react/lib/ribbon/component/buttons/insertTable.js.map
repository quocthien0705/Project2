{"version":3,"file":"insertTable.js","sourceRoot":"","sources":["../../../../../../packages/roosterjs-react/lib/ribbon/component/buttons/insertTable.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { FocusZone, FocusZoneDirection } from '@fluentui/react/lib/FocusZone';\nimport { insertTable as insertTableApi } from 'roosterjs-editor-api';\nimport { mergeStyleSets } from '@fluentui/react/lib/Styling';\nimport { safeInstanceOf } from 'roosterjs-editor-dom';\nimport type RibbonButton from '../../type/RibbonButton';\nimport type { IContextualMenuItem } from '@fluentui/react/lib/ContextualMenu';\nimport type { InsertTableButtonStringKey } from '../../type/RibbonButtonStringKeys';\n\nconst MaxRows = 10;\nconst MaxCols = 10;\nconst classNames = mergeStyleSets({\n    tableButton: {\n        width: '15px',\n        height: '15px',\n        margin: '1px 1px 0 0',\n        border: 'solid 1px #a19f9d',\n        display: 'inline-block',\n        cursor: 'pointer',\n        backgroundColor: 'transparent',\n    },\n    hovered: {\n        border: 'solid 1px #DB626C',\n    },\n    tablePane: {\n        width: '160px',\n        minWidth: 'auto',\n        padding: '4px',\n        boxSizing: 'content-box',\n    },\n    tablePaneInner: {\n        lineHeight: '12px',\n    },\n    title: {\n        margin: '5px 0',\n    },\n});\n\n/**\n * @internal\n * \"Insert table\" button on the format ribbon\n */\nexport const insertTable: RibbonButton<InsertTableButtonStringKey> = {\n    key: 'buttonNameInsertTable',\n    unlocalizedText: 'Insert table',\n    iconName: 'Table',\n    onClick: (editor, key) => {\n        const { row, col } = parseKey(key);\n        insertTableApi(editor, col, row);\n    },\n    dropDownMenu: {\n        items: {\n            insertTablePane: '{0} x {1} table',\n        },\n        itemRender: (item, onClick) => {\n            return <InsertTablePane item={item} onClick={onClick} />;\n        },\n        commandBarSubMenuProperties: {\n            className: classNames.tablePane,\n        },\n    },\n};\n\nfunction InsertTablePane(props: {\n    item: IContextualMenuItem;\n    onClick: (\n        e: React.MouseEvent<Element> | React.KeyboardEvent<Element>,\n        item: IContextualMenuItem\n    ) => void;\n}) {\n    const { item, onClick } = props;\n    const [col, setCol] = React.useState(1);\n    const [row, setRow] = React.useState(1);\n\n    const updateSize = React.useCallback(\n        (t?: HTMLElement | EventTarget) => {\n            if (safeInstanceOf(t, 'HTMLElement')) {\n                const col = parseInt(t.dataset.col ?? '-1');\n                const row = parseInt(t.dataset.row ?? '-1');\n\n                if (col > 0 && col <= MaxCols && row > 0 && row <= MaxRows) {\n                    setCol(col);\n                    setRow(row);\n                }\n            }\n        },\n        [setCol, setRow]\n    );\n\n    const onMouseEnter = React.useCallback(\n        (e: React.MouseEvent<HTMLButtonElement>) => {\n            updateSize(e.target);\n        },\n        [updateSize]\n    );\n\n    const onClickButton = React.useCallback(\n        (e: React.MouseEvent<HTMLButtonElement>) => {\n            onClick(e, {\n                ...item,\n                key: createKey(row, col),\n            });\n        },\n        [row, col, onClick]\n    );\n\n    const ariaLabels = React.useMemo<string[][]>(() => {\n        const result: string[][] = [];\n        for (let i = 1; i <= MaxCols; i++) {\n            const col: string[] = [];\n            for (let j = 1; j <= MaxRows; j++) {\n                col[j] = formatText(item.text ?? '', i, j);\n            }\n            result[i] = col;\n        }\n        return result;\n    }, [item.text]);\n\n    const items = React.useMemo(() => {\n        const items: JSX.Element[] = [];\n\n        for (let i = 1; i <= MaxRows; i++) {\n            for (let j = 1; j <= MaxCols; j++) {\n                const key = `cell_${i}_${j}`;\n                const isSelected = j <= col && i <= row;\n                items.push(\n                    <button\n                        className={\n                            classNames.tableButton + ' ' + (isSelected ? classNames.hovered : '')\n                        }\n                        onClick={onClickButton}\n                        key={key}\n                        id={key}\n                        data-col={j}\n                        data-row={i}\n                        data-is-focusable={true}\n                        onMouseEnter={onMouseEnter}\n                        aria-label={ariaLabels[i][j]}\n                    />\n                );\n            }\n        }\n\n        return items;\n    }, [col, row]);\n\n    const text = formatText(item.text ?? '', row, col);\n\n    return (\n        <div className={classNames.tablePaneInner}>\n            <div className={classNames.title}>{text}</div>\n            <FocusZone\n                defaultActiveElement=\"cell_1_1\"\n                direction={FocusZoneDirection.bidirectional}\n                onActiveElementChanged={updateSize}>\n                {items}\n            </FocusZone>\n        </div>\n    );\n}\n\nfunction formatText(text: string, row: number, col: number) {\n    return text.replace('{0}', col.toString()).replace('{1}', row.toString());\n}\n\nfunction createKey(row: number, col: number) {\n    return `${row},${col}`;\n}\n\nfunction parseKey(key: string): { row: number; col: number } {\n    const [row, col] = key.split(',');\n    return {\n        row: parseInt(row),\n        col: parseInt(col),\n    };\n}\n"]}