{"version":3,"file":"Ribbon.js","sourceRoot":"","sources":["../../../../../packages/roosterjs-react/lib/ribbon/component/Ribbon.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport getLocalizedString from '../../common/utils/getLocalizedString';\nimport { CommandBar } from '@fluentui/react/lib/CommandBar';\nimport { FocusZoneDirection } from '@fluentui/react/lib/FocusZone';\nimport { getObjectKeys } from 'roosterjs-editor-dom';\nimport { mergeStyles } from '@fluentui/react/lib/Styling';\nimport { moreCommands } from './buttons/moreCommands';\nimport type RibbonButton from '../type/RibbonButton';\nimport type RibbonProps from '../type/RibbonProps';\nimport type { ICommandBarItemProps } from '@fluentui/react/lib/CommandBar';\nimport type { FormatState } from 'roosterjs-editor-types';\nimport type {\n    IContextualMenuItem,\n    IContextualMenuItemProps,\n} from '@fluentui/react/lib/ContextualMenu';\nimport type { IRenderFunction } from '@fluentui/react/lib/Utilities';\n\nconst ribbonClassName = mergeStyles({\n    '& .ms-CommandBar': {\n        padding: '0px',\n    },\n});\n\nconst rtlIcon = mergeStyles({\n    transform: 'scaleX(-1)',\n});\n\n/**\n * The format ribbon component of roosterjs-react\n * @param props Properties of format ribbon component\n * @returns The format ribbon component\n */\nexport default function Ribbon<T extends string>(props: RibbonProps<T>) {\n    const { plugin, buttons, strings, dir } = props;\n    const [formatState, setFormatState] = React.useState<FormatState | null>(null);\n    const isRtl = dir == 'rtl';\n\n    const onClick = React.useCallback(\n        (_, item?: IContextualMenuItem) => {\n            if (item) {\n                plugin?.onButtonClick<string>(item.data, item.key, strings);\n            }\n        },\n        [plugin, strings]\n    );\n\n    const onHover = React.useCallback(\n        (button: RibbonButton<T>, key: string) => {\n            plugin.startLivePreview<T>(button, key as T, strings);\n        },\n        [plugin, strings]\n    );\n\n    const onDismiss = React.useCallback(() => {\n        plugin.stopLivePreview();\n    }, [plugin]);\n\n    const flipIcon = React.useCallback(\n        (\n            props?: IContextualMenuItemProps,\n            defaultRender?: (props?: IContextualMenuItemProps) => JSX.Element | null\n        ): JSX.Element | null => {\n            if (!defaultRender) {\n                return null;\n            }\n            return <span className={rtlIcon}>{defaultRender(props)}</span>;\n        },\n        []\n    );\n\n    const commandBarItems = React.useMemo((): ICommandBarItemProps[] => {\n        return buttons.map(\n            (button): ICommandBarItemProps => {\n                const selectedItem =\n                    formatState && button.dropDownMenu?.getSelectedItemKey?.(formatState);\n                const dropDownMenu = button.dropDownMenu;\n\n                const result: ICommandBarItemProps = {\n                    key: button.key,\n                    data: button,\n                    iconProps: {\n                        iconName: button.iconName,\n                    },\n                    onRenderIcon: isRtl && button.flipWhenRtl ? flipIcon : undefined,\n                    iconOnly: true,\n                    text: getLocalizedString(strings, button.key, button.unlocalizedText),\n                    ariaLabel: getLocalizedString(strings, button.key, button.unlocalizedText),\n                    canCheck: true,\n                    checked: (formatState && button.isChecked?.(formatState)) || false,\n                    disabled: (formatState && button.isDisabled?.(formatState)) || false,\n                    ...(button.commandBarProperties || {}),\n                };\n\n                const contextMenuItemRenderer: IRenderFunction<IContextualMenuItem> = (\n                    props,\n                    defaultRenderer\n                ) =>\n                    props && defaultRenderer ? (\n                        <div onMouseOver={e => onHover(button, props.key)}>\n                            {defaultRenderer(props)}\n                        </div>\n                    ) : null;\n\n                if (dropDownMenu) {\n                    result.subMenuProps = {\n                        shouldFocusOnMount: true,\n                        focusZoneProps: { direction: FocusZoneDirection.bidirectional },\n                        onMenuDismissed: onDismiss,\n                        onItemClick: onClick,\n                        onRenderContextualMenuItem: dropDownMenu.allowLivePreview\n                            ? contextMenuItemRenderer\n                            : undefined,\n                        items: getObjectKeys(dropDownMenu.items).map(key => ({\n                            key: key,\n                            text: getLocalizedString<string, string>(\n                                strings,\n                                key,\n                                dropDownMenu.items[key]\n                            ),\n                            data: button,\n                            canCheck: !!dropDownMenu.getSelectedItemKey,\n                            checked: selectedItem == key || false,\n                            className: dropDownMenu.itemClassName,\n                            onRender: dropDownMenu.itemRender\n                                ? item => dropDownMenu.itemRender!(item, onClick)\n                                : undefined,\n                        })),\n                        ...(dropDownMenu.commandBarSubMenuProperties || {}),\n                    };\n                } else {\n                    result.onClick = onClick;\n                }\n\n                return result;\n            }\n        );\n    }, [buttons, formatState, isRtl, strings, onClick, onDismiss, onHover]);\n\n    React.useEffect(() => {\n        const disposer = plugin?.registerFormatChangedCallback(setFormatState);\n\n        return () => {\n            disposer?.();\n        };\n    }, [plugin]);\n\n    const moreCommandsBtn = moreCommands as RibbonButton<string>;\n\n    return (\n        <CommandBar\n            items={commandBarItems}\n            {...props}\n            className={ribbonClassName + ' ' + (props?.className || '')}\n            overflowButtonProps={{\n                ariaLabel: getLocalizedString<string, string>(\n                    strings,\n                    moreCommandsBtn.key,\n                    moreCommandsBtn.unlocalizedText\n                ),\n                ...props?.overflowButtonProps,\n            }}\n        />\n    );\n}\n"]}